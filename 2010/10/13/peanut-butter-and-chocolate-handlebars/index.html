<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruby AOP Made Simple &mdash; TRANSCODE</title>
    <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/logo.png"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="TRANSCODE" />
    <meta name="title" content="Ruby AOP Made Simple ">
    <link rel="canonical" href="http://trans.github.com/2010/10/13/peanut-butter-and-chocolate-handlebars/">
     
           
    <meta property="og:title" content="Ruby AOP Made Simple "/>
    <meta property="og:url" content="http://trans.github.com/2010/10/13/peanut-butter-and-chocolate-handlebars/"/>
    
    
    <meta property="og:site_name" content="TRANSCODE">
</head>
<body>
    
<section class="site-nav">
    <header>
        <nav id="navigation">
            <a class="brand" href="/">
                <img src="/images/logo.png" alt="Inc">
            </a>
            <a href="/" class="home">Blog</a>
            <a href="http://incorporated.sendtoinc.com/">Product</a>
            <a href="https://tabcomputing.com/about/">About</a>
        </nav>
        <nav class="tagline">
            <span>Get a modern blog for your company</span>
            <a href="http://incorporated.sendtoinc.com/" class="btn btn-outline">Learn More</a>
        </nav>
    </header>
</section>


<article>

    <div class="container">
        <header>
            <div class="meta">
                By <address><a rel="author" href="" title="trans" target="_blank">trans</a> &mdash;
                <time pubdate datetime="2010-13-October" title="October 13, 2010">October 13, 2010</time>
            </div>
            <h1 class="title">Ruby AOP Made Simple</h1>
            
        </header>

        <section>
            <h1>Peanut Butter and Chocolate Handlebars</h1>

<p>This week I&#39;ve been working on the <a href="http://github.com/rubyworks/shomen">Shomen</a> documentation project. In particular I&#39;ve been converting the templates of my three web-based documentation viewers to compiled templates in order to boost rendering speed. Originally these viewers were using <a href="http://aefxx.com/jquery-plugins/jqote2/">jqote2</a> in one case (<a href="http://github.com/rubyworks/hypervisor">hypervisor</a>) and <a href="https://github.com/jquery/jquery-tmpl">jquery-tmpl</a> in the other two cases (<a href="http://github.com/rubyworks/rebecca">rebecca</a> and <a href="http://github.com/rubyworks/rubyfaux">rubyfaux</a>). While ascertaining what compilation solution to use, I tried the <a href="https://github.com/wookiehangover/jquery-tmpl-jst">jquery-tmpl-jst</a> for the later two, but immediately ran into fundamental errors. (Sorry, I don&#39;t recollect exactly what the errors were now). They were problematic enough to send me looking else where, and ultimately I decided on <a href="http://handlebarsjs.com/">Handlebars.js</a>.</p>

<p>Handlebars is great... mostly. Handlebars a variant of <a href="http://mustache.github.com/">Mustache</a> and is billed like Mustache as &quot;logic-less&quot; templates. But, whereas Mustache is <em>pure</em> about this ideal, Handlebars backs off a bit and at least allows some computation to take place via helpers. Unfortunately, from my experience I have found the ideal of &quot;logic-less&quot; templates to be largely misplaced, and not even Handlebars goes far enough to rectify the situation. What one ends up doing is just moving the &quot;logic&quot; to a separate file where it mostly consists of bits of trivial code and where it is more difficult to maintain because it is separated from the specific bit of markup it supports.</p>

<p>Take this example. It&#39;s the last bit of jqeury-tmpl I needed to convert to Handlebars for rubyfaux.</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html">  ${divy  = Rubyfaux.divy_methods(methods),&#39;&#39;}
  ${scope = [&#39;class&#39;,&#39;instance&#39;],&#39;&#39;}
  ${sight = [&#39;public&#39;,&#39;protected&#39;,&#39;private&#39;],&#39;&#39;}




        <span class="nt">&lt;h3&gt;</span>${v.capitalize()} ${s.capitalize()} METHODS<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;reference-list&quot;</span><span class="nt">&gt;</span>



        <span class="nt">&lt;/ul&gt;</span>
</code></pre></div>
<p>How does one translate this to Handlbars.js? It isn&#39;t a straight forward process. Handlebars doesn&#39;t allow the embedded assignments. So right off we see that <code>scope</code> and <code>sight</code> must be extracted. Secondly, the fact that some of the template is only shown if the combination of <code>scope</code> and <code>sight</code> has any entries, means this can&#39;t be rendered via a single Handlebars block helper. It has to be broken up so we can use a helper to render only if there are entries for each combination. But then it becomes difficult, if not impossible, to loop over <code>scope</code> and <code>sight</code> to keep our code DRY. Instead we end up with something like:</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html">    <span class="nt">&lt;h3&gt;</span>PUBLIC CLASS METHODS<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;reference-list&quot;</span><span class="nt">&gt;</span>







  ... ditto for each combination of scope and sight ...
</code></pre></div>
<p>Thank goodness there are only six combinations!</p>

<p>Of course, there is a way around this explosion in code. We can use a single block helper, but only if we render the <code>h3</code> and <code>ul</code> tags via the block helper too.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span><span class="p">(</span><span class="s1">&#39;methods_categorized&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">meths</span> <span class="o">=</span> <span class="nx">Rubyfaux</span><span class="p">.</span><span class="nx">divy_methods</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">methods</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">scope</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">,</span><span class="s1">&#39;instance&#39;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">sight</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span><span class="s1">&#39;protected&#39;</span><span class="p">,</span><span class="s1">&#39;private&#39;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">sight</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">combination</span> <span class="o">=</span> <span class="nx">meths</span><span class="p">[</span><span class="nx">scope</span><span class="p">[</span><span class="nx">i</span><span class="p">]][</span><span class="nx">sight</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">combination</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s2">&quot;&lt;h3&gt;&quot;</span> <span class="o">+</span> <span class="nx">scope</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">sight</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; METHODS&lt;/h3&gt;\n&quot;</span><span class="p">;</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s1">&#39;&lt;ul class=&quot;reference-list&quot;&gt;&#39;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">combination</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="nx">block</span><span class="p">(</span><span class="nx">meths</span><span class="p">);</span>
          <span class="p">};</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s2">&quot;\n&lt;/ul&gt;&quot;</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>    
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>
<p>Then our Handlebars template becomes the very simple:</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html">
</code></pre></div>
<p>But what on earth have we done!? Pursuing the ideal of keeping our views cleansed of logic, and DRY, we&#39;ve ended up putting our view in our logic! You would think this is an obvious &quot;no no&quot; too, but look at some of the examples on <a href="http://handlebarsjs.com/">Handlebars.js</a> website and you will see they do this quite regularly.</p>

<p>Perhaps there is a more appropriate way to handle the above example, and I am all ears. But after giving the whole concept of keeping logic completely out of views, I&#39;ve come to the conclusion that it&#39;s really not so ideal. Like Reese&#39;s mixing chocolate and peanut butter, mixing views and logic can be a good thing. The trick is limiting the logic to particular domains, let&#39;s call it &quot;view logic&quot; as opposed to &quot;data logic&quot;.</p>

<p>View logic should be limited to these purposes:</p>

<ul>
<li>Conditions</li>
<li>Sorting</li>
<li>Categorizing</li>
<li>Formatting</li>
</ul>

<p>By limiting view logic to these, I&#39;d say we have still achieved the ideal of &quot;logic-less templates&quot;. By being zealots about the logic-less concept we end-up just creating the opposite problem of mixing our templates into our logic, which is just as bad, if not worse. Template engines, like Handlebars.js, would do well to take this into account and expand their capabilities to include more flexible conditions, sorting, categorizing and formatting constructs and helpers out of the box.</p>

            
        </section>

        <footer>
            <address>
               
                <p>Written by <strong><a rel="author" href="https://twitter.com/" title="" target="_blank">trans</a></strong><br>
                <span class="muted"></span>
                </p>
            </address>

        </footer>

        
    </div>
</article>


<footer class="site-footer">
    <div class="container">
        &copy; 2014 
        
        <nav>
            <a href="http://tabcomputing.com/">Tab Computing</a> &middot;
            <a href="/">Blog</a> &middot;
            <a href="http://incorporated.sendtoinc.com/">Product</a> &middot; 
            <a href="https://tabcomputing.com/about/">About</a>
        </nav>
        
        <nav class="social">
            
                
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
        <p>Incorporated theme by <a href="https://sendtoinc.com">Inc</a></p>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>






</body>
</html>
