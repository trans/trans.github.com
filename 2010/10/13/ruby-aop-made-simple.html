<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Ruby Aop Made Simple @ 7R4N5C0D3</title>
    <meta name="author" content="Trans" />

    <link rel="icon" type="image/png" href="/assets/images/trans-logo.png">

    <link rel="stylesheet" href="/assets/styles/main.css" type="text/css"/> 
    <link rel="stylesheet" href="/assets/styles/code.css" type="text/css"/>  
    <link rel="stylesheet" href="/assets/styles/pygment.css" type="text/css"/>

    <link rel="stylesheet" href="/assets/styles/custom.css?reload=true" type="text/css"/>
    <link rel="stylesheet" href="/assets/styles/social.css?reload=true" type="text/css"/>  

    <link href='http://fonts.googleapis.com/css?family=Jura:400,500' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>

    <!--[if lt IE 9]>
    <script src="/scripts/html5.js"></script>
    <![endif]-->

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

    <script type="text/javascript" src="/assets/scripts/jquery.easing.js"></script>
    <script type="text/javascript" src="/assets/scripts/jquery.social.share.1.2.min.js"></script>

    <script src="/assets/scripts/main.js"></script>

    <script>
      $(document).ready(function(){
        $('#social-share').dcSocialShare({
          twitterId: 'transgigamic',
          tabText: '<img src="/assets/images/tab_share.png" alt="Share" />',
          buttons: 'twitter,facebook,plusone,stumbleupon,digg,linkedin,pinit'
        });
      });
    </script>

    <!-- tracking code here ? -->
</head>

<body>

  <div id="container">

		<div id="header">
			<h1>7R4N5C0D3</h1>
		</div>

		<div id="nav">
      <ul>
      <li><a href="/index.html">Index</a></li>
      <li><a href="/Home.html">Home</a></li>
      <li><a href="/Projects.html">Projects</a></li>
      <li><a href="/Reads.html">Reads</a></li>
      <li><a href="/Tools.html">Tools</a></li>
      <li><a href="http://github.com/trans/wiki">Wiki</a></li>
      <li><a href="/atom.xml">Feed</a></li>
      </ul>
		</div>

<div id="content-wrapper">
<div id="content">

<div class="path" style="clear: both; float: right;" >
  13 Oct 2010
</div>

<div id="post">
<h1>Ruby AOP Made Easy</h1>

<h2>Quick Recap</h2>

<p>Aspect Oriented Programming (AOP) is a topic I have spent a fair amount of
time contemplating. I, along with Peter VanBroekhoven, developed
the concept of Cut-based AOP back in <code>05-</code>06. A limited &quot;toy&quot; implementation of
which can be had by installing the <code>cuts</code> gem. The basic idea behind Cut-based
AOP is the <i>transparent subclass</i>, a.k.a. the <em>cut</em>, which is essentially
a subclass that subsumes the role of the class it effects without the programmer
needing any knowledge of it doing do. In this way, the cut serves as the atomic
construct in a purely object-oriented appraoch to AOP. You can read more about it
<a href="http://github.com/rubyworks/cuts/blob/master/RCR.textile">here</a>.</p>

<p>In dicussing this idea on the ruby-talk mailing list it was suggested that
an easier approach would be to forgo the Cut class and simply allow modules
to be &quot;prepended&quot; to the class or module to which they are applied. So for
instance we might write:</p>
<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="nc">C</span>
      <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">;</span> <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">A</span>
      <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span> <span class="p">;</span> <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class</span> <span class="nc">C</span>
      <span class="n">prepend</span> <span class="n">A</span>
    <span class="k">end</span>

    <span class="n">C</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>  <span class="c1">#=&gt; &quot;{hello}&quot;</span>
</code></pre>
</div>

<p>Cut-based AOP is a general OOP design that can be applied to any
object-oriented programming language. But for Ruby, the idea of <code>prepend</code>,
while more limited, does serve much of the same purpose, and the idea is up for 
<a href="">consideration</a> in a future verison of Ruby.</p>

<h2>Another Way</h2>

<p>There is however another way to essentially use prepend-like AOP in Ruby without
extending Ruby in any special way. The trick is simply to design classes
and module to be &quot;AOP-ready&quot;. Here is an example of the above using nothing
more than standard Ruby.</p>
<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="nc">C</span>
      <span class="k">module</span> <span class="nn">Joinable</span>
        <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">;</span> <span class="k">end</span>
      <span class="k">end</span>
      <span class="kp">include</span> <span class="no">Joinable</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">A</span>
      <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span> <span class="p">;</span> <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class</span> <span class="nc">C</span>
      <span class="kp">include</span> <span class="n">A</span>
    <span class="k">end</span>

    <span class="n">C</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>  <span class="c1">#=&gt; &quot;{hello}&quot;</span>
</code></pre>
</div>

<p>Pretty easy. We have simply encapsulate C&#39;s instance methods in a &quot;Joinable&quot;
module, thus any new inclusions into C itself will actually come <em>before</em>
these methods.</p>

<p>This of course raises the issue of including modules in the normal fashion,
in which case we would need in include them in Joinable itself, e.g.</p>
<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="nc">C</span>
      <span class="k">module</span> <span class="nn">Joinable</span>
        <span class="kp">include</span> <span class="no">Foo</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre>
</div>

<p>We could facilitate this will a little bit of Ruby magic.</p>
<div class="highlight"><pre><code class="ruby">    <span class="k">class</span> <span class="nc">Module</span>
      <span class="n">alias_method</span> <span class="ss">:_include</span><span class="p">,</span> <span class="ss">:include</span>

      <span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">const_defined?</span><span class="p">(</span><span class="ss">:Joinable</span><span class="p">)</span>
          <span class="n">core</span> <span class="o">=</span> <span class="nb">const_get</span><span class="p">(</span><span class="ss">:Joinable</span><span class="p">)</span>
          <span class="n">core</span><span class="o">.</span><span class="n">_include</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="n">_include</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">prepend</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">const_defined?</span><span class="p">(</span><span class="ss">:Joinable</span><span class="p">)</span>
          <span class="n">_include</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="k">raise</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2"> is not Joinable&quot;</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre>
</div>

<p>This is a very simplistic implementation, but a robust implementation would
be only slightly more complex. Now, as along as we use <code>Joinable</code>,
we can use #prepend.</p>

<hr>

<p>title      : Ruby AOP Made Simple
author     : trans
date       : 2010-10-13
categories : [aop, cuts, ruby]
layout     : post</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span class="post-date">17 Jun 2012</span> &raquo; <a href="/2012/06/17/kill-the-proxy-and-save-toplevel.html">Kill The Proxy And Save Toplevel</a></li>
    
      <li><span class="post-date">14 Jun 2012</span> &raquo; <a href="/2012/06/14/autoload-smells-like-denmark.html">Autoload Smells Like Denmark</a></li>
    
      <li><span class="post-date">13 Jun 2012</span> &raquo; <a href="/2012/06/13/instance-variables-as-syntax-sugar.html">Instance Variables As Syntax Sugar</a></li>
    
  </ul>
</div>

</div>
</div>

<!-- Start Shareaholic Sexybookmarks -->
<div class="shr_class shareaholic-show-on-load">
</div>

<script type="text/javascript">
var SHRSB_Settings = {"shr_class":{"src":"/assets/shareaholic","link":"","service":"236,45,5,7,88,92,61,204,202,102,3,40,10,2,38,195,27,48,6,1,218,24,46,267,74,191,265,219,210,78,240,207,54,53,52,201","apikey":"6ffe2cbf142c45bd4cd03b01ec46b8658","localize":true,"shortener":"google","shortener_key":"","designer_toolTips":true,"twitter_template":"${title} - ${short_link} via @Shareaholic"}};
</script>

<script type="text/javascript">
(function() {
var sb = document.createElement("script"); sb.type = "text/javascript";sb.async = true;
sb.src = ("https:" == document.location.protocol ? "https://dtym7iokkjlif.cloudfront.net" : "http://cdn.shareaholic.com") + "/media/js/jquery.shareaholic-publishers-sb.min.js";
var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(sb, s);
})();
</script>
<!-- End Shareaholic Sexybookmarks -->

<!-- Start Disqus Commments -->
<div id="comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /**
     * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread] 
     */
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = 'http://transcode.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=transcode">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<!-- End Disqus Commands -->

<div id="social-share"></div>


		<div id="footer">
      <div class="tiger">
      </div>
			<small>Last edited by <b></b> on 13 Oct 2010.</small>
			<small style="float:right;">
				This site is a <a href="https://github.com/blog/699-making-github-more-open-git-backed-wikis">GitHub Wiki</a>
				mirror powered by <a href="http://rubyworks.github.com/smeagol">Smeagol</a>.
			</small>
		</div>

  </div>

</body>
</html>
