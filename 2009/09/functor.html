
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />

  <title>Welcome to Webrite</title>

  <!-- google verification-->
  <meta name="verify-v1" content="p14vW7GGMohDo2YKUHm0SXXTL+tzyPbKxxp35/WIQLA=" />

  <meta name="DESCRIPTION"
        content="Webrite is a K.I.S.S. website builder."/>

  <link rel="icon" href="../../assets/images/icon.gif" type="image/x-icon" />

  <link href="atom.xml" rel="alternate" title="blog.webrite.rubyforge.org" type="application/atom+xml" />

  <!-- STYLESHEETS -->

  <link href="../../assets/styles/reset.css"  rel="stylesheet" type="text/css" />

  <link href="../../assets/styles/screen.css" rel="stylesheet" type="text/css" media="screen, projection" />
  <link href="../../assets/styles/print.css"  rel="stylesheet" type="text/css" media="print" />

  <!--[if IE]>
      <link href="/ie.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <![endif]-->

  <link href="../../assets/styles/layout.css"  rel="stylesheet" type="text/css" />
  <link href="../../assets/styles/font.css"    rel="stylesheet" type="text/css" />
  <link href="../../assets/styles/color.css"   rel="stylesheet" type="text/css" />
  <link href="../../assets/styles/syntax.css"  rel="stylesheet" type="text/css" />

  <!-- <script src="js/rdocs.js" type="text/javascript"></script> -->
</head>
<body>

<div class="header">
  <div class="header-inner">
    <div class="title">
      <img src="../../assets/images/sevenhand.gif" style="float: right; height: 210px; margin-top: -5px;"/>
      <img class="logo" src="../../assets/images/transcode.png" width="500px" align="top" />
    </div>
    <div class="menu">
      <div class="menu-inner">
        <a href="../../blog.html">Blog</a> &middot;
        <a href="../../tags.html">Tags</a> &middot;
        <a href="http://groups.google.com/group/tigerops-community?hl=en">Mail</a> &middot;
        <a href="pussy.html">Pussy</a> &middot;
        <a href="../../about.html">About</a>
      </div>
    </div>
  </div>
</div>

<div class="doc">
  
<div class="page">

  <h1>Functor</h1>

  <h1>Functor : Object :: Enumerator : Enumerable</h1>

<p>In Ruby 1.9, Enumerable methods return an Enumerator when no block is provided them. This makes it very convenient to chain methods in what is often called <em>fluid notation</em>. For example, rather than the usual +#each_with_index+, one can use:</p>

<div class="CodeRay">
  <div class="code"><pre>
  [<span style="color:#00D;font-weight:bold">1</span>,<span style="color:#00D;font-weight:bold">2</span>,<span style="color:#00D;font-weight:bold">3</span>].each.with_index{ |e, i| ... }

</pre></div>
</div>

<p>Plenty of other possibilities along these lines become possible. It's a very powerful technique.</p>

<p>In the same spirit, I think there is another class that could be used in much the same way for more general methods, namely what Ruby Facets calls a <em>Functor</em> --a function that acts on a function. Essentially, it is defined as:</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Functor</span>
    private(*instance_methods.select { |m| m !~ <span style="background-color:#fff0ff"><span style="color:#404">/</span><span style="color:#808">(^__|^binding$)</span><span style="color:#404">/</span></span> })
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">initialize</span>(&amp;function)
      <span style="color:#33B">@function</span> = function
    <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">to_proc</span>
      <span style="color:#33B">@function</span>
    <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">method_missing</span>(op, *args, &amp;blk)
      <span style="color:#33B">@function</span>.call(op, *args, &amp;blk)
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

</pre></div>
</div>

<p>An interesting example of it's use if overriding +#instance_eval+ to return a functor when no block is provided.</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Object</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">instance_eval</span>(*args, &amp;blk)
      <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">super</span> <span style="color:#080;font-weight:bold">if</span> blk <span style="color:#080;font-weight:bold">or</span> !args.empty?
      <span style="color:#33B">@_instance_eval</span> ||= <span style="color:#036;font-weight:bold">Functor</span>.new <span style="color:#080;font-weight:bold">do</span> |op, *a, &amp;b|
        fcall(op, *a, &amp;b)
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

</pre></div>
</div>

<p>Now we can call a single method via instance_eval using fluid notation instead of having to open a block.</p>

<div class="CodeRay">
  <div class="code"><pre>
  <span style="color:#036;font-weight:bold">MyClass</span>.instance_eval.attr_accessor <span style="color:#A60">:x</span>

</pre></div>
</div>

<p>There are many other similar uses for Functors. Just as Enumerator opens up a great deal of convenience and conciseness for Enumerable methods, Functor can do the same for methods generally.</p>


  <small>Written by trans, 2009-09-30</small>

  <ul class="posts">
    
    
  </ul>

</div>


</div>

<br style="clear: both;"/><br/><br/>

<div class="footer">
<div class="footer-inner">
  Copyright (c) 2005,2009 Thomas Sawyer
</div>
</div>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2883355-2";
urchinTracker();
</script>

</body>
</html>

