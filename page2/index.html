<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRANSCODE &mdash; Trans Technology and Programming Blog</title>
    <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/trans-logo.png"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="TRANSCODE" />
    <meta name="title" content="TRANSCODE">
    <link rel="canonical" href="http://trans.github.com/page2/">
     
           
    <meta property="og:title" content="TRANSCODE"/>
    <meta property="og:url" content="http://trans.github.com/page2/"/>
    
    
    <meta property="og:site_name" content="TRANSCODE">
</head>
<body>
    
<section class="site-nav">
    <header>
        <nav id="navigation">
            <a class="brand" href="/">
                <img src="/images/trans-logo.png" alt="Inc" height="120px">
            </a>
            <a href="/" class="home">Blog</a>
            <a href="http://github.com/trans">Github</a>
            <a href="/About/">About</a>
        </nav>
        <nav class="tagline">
            <span>Check out all of my open source work</span>
            <a href="http://github.com/trans" class="btn btn-outline">Learn More</a>
        </nav>
    </header>
</section>

<div class="blog-cover" style="background-image:url(/images/blog-cover.jpg);">
    
    <section>
        <div class="container">
            <h1>TRANSCODE</h1>
            <h3>Trans Technology and Programming Blog</h3>
        
            
            <a href="https://twitter.com/transgigamic" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter"></i></a>
            
            
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss"></i>
            </a>
        </div>
    </section>
</div>

<article class="container">

  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2013/01/04/the-plethora-of-version-versions/" rel="prefetch">The Plethora Of Version Versions</a></h2>
            <p><h1>The Plethora of Version Versions</h1>

<p>A couple of my programs have need of a Version API --a library for handling version numbers, and handling them well. Not only do they need a class modeling a <em>version number</em>, but also a <em>version constraint</em> and in one case even a <em>version conflict resolver</em> for requirements. Presently each project had its own code for handling versions. But as these projects have evolved it has became increasingly clear that effort was being wasted and that I should pull the separate bits of code together into a single gem on which they all could depend.</p>

<p>So I created the new project --actually it was some time ago, but I ran into that not-so-unusual snag, what to name it. Unfortunately there was already a <code>version</code> gem, and could think of no better name. So I put the whole thing on the back burner for some months. Today I finally returned to the question. I still don&#39;t have an answer, but to be thorough I searched of RubyGems.org using &quot;vers&quot;. I thought there were a lot of ANSI code gems!</p>

<ul>
<li><a href="https://github.com/Ataxo/app-version-git">app-version-git</a></li>
<li><a href="https://github.com/westarete/aversion">Aversion</a></li>
<li><a href="https://github.com/jeffp/gem_version">GemVersion</a></li>
<li><a href="https://github.com/Bodacious/per-version">PerVersion</a></li>
<li><a href="https://github.com/AlphaHydrae/rake-version">rake-version</a></li>
<li><a href="https://github.com/martinkozak/ruby-version">Ruby Version</a></li>
<li><a href="https://github.com/canton7/sem_version">SemVersion</a></li>
<li><a href="https://github.com/stouset/version">version</a></li>
<li><a href="https://github.com/jondot/version_bumper">version_bumper</a></li>
<li><a href="https://github.com/djsun/version_string">version_string</a></li>
<li><a href="https://github.com/RiverGlide/Versionary">Versionary</a></li>
<li><a href="https://github.com/charlotte-ruby/versionator">Versionator</a></li>
<li><a href="http://rubyforge.org/projects/versioncheck">VersionCheck</a></li>
<li><a href="https://github.com/chaione/versioner">versioner</a></li>
<li><a href="https://github.com/xaviervia/versionifier">Versionifier</a></li>
<li><a href="https://github.com/jcangas/version_info">VersionInfo</a></li>
<li><a href="http://rubygems.org/gems/versionize">Versionize</a></li>
<li><a href="https://github.com/thomasbiddle/versionr">Versionr</a></li>
<li><a href="https://github.com/defunkt/version_sorter">VersionSorter</a></li>
<li><a href="https://github.com/meh/versionub">Versionub</a></li>
</ul>

<p>The majority of these gems address the same functionality, that of bumping a version number. Some of those provide rake tasks to do so, others just the API, and a couple go a step further handling git commits and gem pushes as well. One a few actually focus on modeling a <em>version number</em>, though all have some sort of internal model no matter how simplistic. Only one appears to provide a model any more sophisticated than simple comparison and accessing named components (major, minor, patch, etc.). SemVersion also has simple constraint testing.</p>

<p>It&#39;s too bad there is not more cooperation among gem developers. I think this is an area in which the Perl community has shined. Surely in no small part to <a href="http://cpan.org">CPAN</a> and the culture of naming libraries functionally, rather then creatively. </p>

<p>Still doesn&#39;t help me name mine.</p>

<hr>

<p>Note <a href="https://github.com/phs/versionable">Versionable</a> is something different, and pretty neat.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2013-04-January" title="January 04, 2013">January 04, 2013</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2013/01/01/what-concerns/" rel="prefetch">What Concerns</a></h2>
            <p><h1>What Concerns?</h1>

<p>David Heinemeier Hansson, the well known creator of Rails, recently gave a little <a href="http://37signals.com/svn/posts/3372-put-chubby-models-on-a-diet-with-concerns">pep-talk</a> for the use of <code>ActiveSupport::Concerns</code>, making an argument that they were sufficient to satisfy the practical needs of <a href="http://en.wikipedia.org/wiki/Data,_context_and_interaction">DCI</a>&#39;s theory.</p>

<p>What he fails to explain is what Concerns <em>really are</em>. Truth be told, Concerns are essentially a extension of Ruby&#39;s <code>Module</code> class to more fully support <em>multiple inheritance</em>. Whether out of indifference, simple oversight or perhaps a bit of decorum to save Matz&#39;s sensitivities, who has a well known distaste for multiple inheritance, DHH never mentions this simple fact. Concerns are a way for Rails developers to include Modules with the same degree of functionality as inheriting from a superclass.</p>

<p>To say that Concerns are like DCI Roles, is akin to saying C structs are like OOP Objects. Yea, there&#39;s a similarity there, but it&#39;s vastly missing the point.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2013-01-January" title="January 01, 2013">January 01, 2013</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/12/04/about-those-refinements/" rel="prefetch">About Those Refinements</a></h2>
            <p><h1>About those Refinements</h1>

<p>Well, after a ridiculously long discussion about refinements, it&#39;s finally become clear what Matz is up to. It would have helped if he had mentioned from the start that he&#39;s patterning them directly off of Smalltalk wrappers and CLOS method combinations. Instead we get <a href="http://bugs.ruby-lang.org/projects/ruby-trunk/wiki/RefinementsSpec">this</a> &quot;offical&quot; spec. Hardly. It was only thanks to Charles Nutters careful <a href="https://bugs.ruby-lang.org/issues/4085#note-217">analysis</a> that I was able to to get a clear picture. Oh, the time and data that could have been saved!</p>

<p>So allow me to save you all the trouble and explain refinements in very simple phrase: <em>macros des méthodes</em>. In plain English, they are macros that act on method invocations. For example,</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">M</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
    <span class="n">string</span><span class="o">.</span><span class="n">to_s</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">Q</span>
  <span class="n">refine</span> <span class="nb">String</span>
    <span class="k">def</span> <span class="nf">to_s</span>
      <span class="s2">&quot;Every string is </span><span class="si">#{</span><span class="k">super</span><span class="si">}</span><span class="s2">!&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">using</span> <span class="n">Q</span>

<span class="n">M</span><span class="o">.</span><span class="n">string</span><span class="p">(</span><span class="s2">&quot;okay&quot;</span><span class="p">)</span> <span class="c1">#=&gt; &quot;okay&quot;</span>
</code></pre></div>
<p>Notice, the <code>M.string</code> method is not effected by the refinement of <code>String#to_s</code> even though it uses <code>#to_s</code> in its definition. However, if we use <code>#to_s</code> explicitly in the scope of the refinement&#39;s use we get:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="s2">&quot;okay&quot;</span><span class="o">.</span><span class="n">to_s</span> <span class="c1">#=&gt; &quot;Every string is okay!&quot;</span>
</code></pre></div>
<p>Even though that is exactly what the definition of <code>M.string</code> is, it produces the refined result instead. Since the call was explicit the refinement interceded.</p>

<p>That&#39;s really the crux of refinements. Most of the remaining questions pertain to the order in which multiple refinements interact, but it is all pretty much as one would intuit it to be, so we won&#39;t go into detail in that regard.</p>

<p>Now I thought it might be helpful to take an extreme example of what one could do with refinements and see if it leads us to anything interesting.</p>

<p>Let&#39;s take just a bare class.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Person</span>
<span class="k">end</span>
</code></pre></div>
<p>Now lets create two refinements defining two different roles a person might take.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">Buyer</span>
  <span class="n">refine</span> <span class="no">Person</span> <span class="k">do</span>
    <span class="kp">attr</span> <span class="ss">:stuff</span><span class="p">,</span> <span class="ss">:money</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">money</span><span class="p">,</span> <span class="o">*</span><span class="n">stuff</span><span class="p">)</span>
      <span class="vi">@money</span> <span class="o">=</span> <span class="n">money</span><span class="o">.</span><span class="n">to_f</span>
      <span class="vi">@stuff</span> <span class="o">=</span> <span class="n">stuff</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">buy</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
      <span class="vi">@stuff</span><span class="o">.</span><span class="n">push</span> <span class="n">product</span>
      <span class="vi">@money</span> <span class="o">-=</span> <span class="vi">@money</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">Seller</span>
  <span class="n">refine</span> <span class="no">Person</span> <span class="k">do</span>
    <span class="kp">attr</span> <span class="ss">:stuff</span><span class="p">,</span> <span class="ss">:money</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">money</span><span class="p">,</span> <span class="o">*</span><span class="n">stuff</span><span class="p">)</span>
      <span class="vi">@money</span> <span class="o">=</span> <span class="n">money</span><span class="o">.</span><span class="n">to_f</span>
      <span class="vi">@stuff</span> <span class="o">=</span> <span class="n">stuff</span>
    <span class="k">end</span>
    <span class="k">def</span> <span class="nf">sell</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
      <span class="vi">@stuff</span><span class="o">.</span><span class="n">delete</span> <span class="n">product</span>
      <span class="vi">@money</span> <span class="o">+=</span> <span class="vi">@money</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Now let&#39;s define an activity in which persons interact as each of these roles.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="n">using</span> <span class="no">Seller</span>
<span class="n">using</span> <span class="no">Buyer</span>

<span class="k">class</span> <span class="nc">SalesTransaction</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">make</span><span class="p">(</span><span class="n">buyer</span><span class="p">,</span> <span class="n">seller</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
    <span class="n">buyer</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
    <span class="n">seller</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Interesting? Person has no built-in behavior, and yet we&#39;ve managed to use the class to model a sales transaction and give each person state of what they own and how much money they have. And an outside interface can&#39;t find this state out unless it knows what role to apply!</p>

<p>You might recognize the pattern of this example. It is <a href="http://en.wikipedia.org/wiki/Data,_context_and_interaction">DCI</a>. Does this mean refinements are a prefect fit for DCI-based designs? Might we see a whole new paradigm in Ruby architecture built around the DCI? That&#39;s a good question. At first glance it certainly seems to be possible. But we should note a obvious downsides.</p>

<ol>
<li>Both refinements required an <code>#initialize</code> method to ensure the instance variables are initialized. So  refinements of this kind would have to be compatible in this respect in order to be used together.</li>
<li>The context, in this case <code>SalesTransaction</code>, has to exist in it&#39;s own file so only the appropriate refinements apply. There is no way to define contexts that use different refinements in the same file because refinements are applied on a per-file basis. Although, some level of cleverness could be played if certain contexts simply add additional refinements on top of those used earlier in the file.</li>
<li>While it remains to be seen, it is unlikely that an entire system written in this fashion will be very fast. Nor is entirely certain the it would very comprehensible, but perhaps that has more to do with DCI then refinements.</li>
</ol>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-04-December" title="December 04, 2012">December 04, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/12/01/bye-bye-webri/" rel="prefetch">Bye Bye Webri</a></h2>
            <p><h1>Bye Bye WebRI</h1>

<p>RDoc 4.0 is coming out and it can now render documentation directly from ri stores. That&#39;s super great news. I had written just such a program back in 2008 called WebRI. It was a terrible hack, and slow as molasses running up a tree. So it never got much use. But it was still pretty neat because it made it possible to browse all installed gems in one go. It was wild to see every single class and module of every gem listed in the side pane. I hope RDoc 4.0 will be able to do something like that. Even so I am certain it will be better in just about every other way. My implementation may have sucked, but the idea was obviously a good one. It&#39;s always nice to feel a bit of vindication in that way.</p>

<p><img src="http://trans.github.com/media/webri.png" alt="WebRI"></p>

<p>Of course, this also means that WebRI is completely obsolete now. Come the new year I will delete the repository and yank the gem. No reason to keep useless cruft about.</p>

<p>BTW As of next year I will have been programming in Ruby for over a decade. Ten fucking years!</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-01-December" title="December 01, 2012">December 01, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/08/07/Going-Generic/" rel="prefetch">Going Generic</a></h2>
            <p><h1>Going Generic</h1>

<p>My Grandmother will often buy generic brands at the grocery to save a few dollars. A child of the depression, she knows the true value of a thing[^1]. Go could take a lesson from her.</p>

<p>Let me provide an example. Here is code to concat two array of string.[^2]</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">func concat(a, b []string) []string {
  ret := make([]string, len(a) + len(b))
  copy(ret, a)
  copy(ret[len(a):], b)
  return ret
}
</code></pre></div>
<p>It can only be used for []string values. Nothing else. If I need to concat two int arrays, well then I need another function.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">func concat(a, b []int) []int {
  ret := make([]int, len(a) + len(b))
  copy(ret, a)
  copy(ret[len(a):], b)
  return ret
}
</code></pre></div>
<p>There is no difference between these two functions except the array&#39;s element type. Ideally a general solution would allow use to name the type, e.g.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">func concat(a, b []&lt;t&gt;) []&lt;t&gt; {
  ret := make([]&lt;t&gt;, len(a) + len(b))
  copy(ret, a)
  copy(ret[len(a):], b)
  return ret
}
</code></pre></div>
<p>From what I have heard there are some strict criteria to be met for any general solution to this issue. I plan to do some further reading.</p>

<p>[^1]: Sometimes too much so actually. Of an emptied product container she&#39;ll often say, &quot;this is fine container, surely you must have something you can put in it&quot;. :)</p>

<p>[^2]:  Yes, there is simpler way to concat two arrays, i.e. <code>append(a1, a2...)</code>, but the concat function makes for a clear example of the generics issue. The specific functionality is not important.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-07-August" title="August 07, 2012">August 07, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/07/04/crossing-the-assets-divide/" rel="prefetch">Crossing The Assets Divide</a></h2>
            <p><h1>Crossing the Assets Divide</h1>

<p>Working on <a href="http://github.com/rubyworks/smeagol">Smeagol</a>, a read-only Gollum server and static site generator, I&#39;ve come across an unusual issue. One of the features Smeagol provides is the ability to view page history. By providing a git commit-id or a tag name in the URL, an older version of any page can be viewed. Now, if a page includes a local asset, an image being the typical example, that file clearly must come from the same commit as well. And here is were a problem arises. While <em>content assets</em> must be versioned, <em>design assets</em> must not. We may want to look at the content of an old page for historical reference; we don&#39;t want look at it as if on the website as it was designed way back when. Indeed, the functionality of the site back then might have had bugs in it, it might have a had a very stark layout, it might have any number of issues which have since been corrected. Certainly the site should not serve up old stylesheets, javascripts, background images and the like. Only old <em>content</em> must be served.</p>

<p>As it has become the fashion in web-design, stylesheets, javascripts, images, and so on are placed in a single <code>assets/</code> directory. (Even without an <code>assets/</code> directory, asset files are generally placed in central bins such as <code>images/</code>.)  Because of this there is no straight forward way to determine which files are for content and which are for site design. So, as it happens, there turns out to be a need to divide the assets in two. One directory for design and another for content.</p>

<p>I now find myself with the unenviable decision of what to name these two directories. Do I keep <code>assets/</code> for design or content? And what do I name the other directory? Or should I use two new names altogether?</p>

<p>[UPDATE] At present I have opted to keep <code>assets/</code> for design-related files and move content assets to <code>media/</code>. Technically, it turns out that it doesn&#39;t matter where the content files go as long as it is not in <code>assets/</code>. </p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-04-July" title="July 04, 2012">July 04, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/06/26/Example/" rel="prefetch">Example</a></h2>
            <p><h1>Example</h1>

<p>This is an example. I am wondering how this gets saved.</p>

<!-- Comment
Can we hide things this way?
-->
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-26-June" title="June 26, 2012">June 26, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/06/25/is-it-time-to-leave-home/" rel="prefetch">Is It Time To Leave Home</a></h2>
            <p><h1>Is It Time to Leave Home?</h1>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-25-June" title="June 25, 2012">June 25, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/06/17/kill-the-proxy-and-save-toplevel/" rel="prefetch">Kill The Proxy And Save Toplevel</a></h2>
            <p><h1>Kill the Proxy and Save Toplevel</h1>

<p>One of the more curious aspects of Ruby is the &quot;top level&quot; object, otherwise known as <code>main</code>.</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash">  <span class="nv">$ </span>pry
  <span class="o">[</span>1<span class="o">]</span> pry<span class="o">(</span>main<span class="o">)</span>&gt; <span class="nv">self</span>
  <span class="o">=</span>&gt; main
</code></pre></div>
<p>This <code>main</code> is rather odd entity in that it is a special object with special functionality that delegates to the Object class. For example, using <code>def</code> at the top level actually defines a new private method on the Object class.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">def</span> <span class="nf">hello_world</span>
  <span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span>   <span class="s2">&quot;Hello Wolrd&quot;</span>
  <span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">end</span>
  <span class="o">[</span><span class="mi">4</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Object</span><span class="o">.</span><span class="n">private_instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
  <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:DelegateClass</span><span class="p">,</span> <span class="ss">:hello_world</span><span class="o">]</span>
</code></pre></div>
<p>Did you have any idea that the top level was so powerful as to pervade every object in the system? Well, usually it doesn&#39;t present an issue since NO ONE IN THEIR RIGHT MIND EVER DEFINES A METHOD AT THE TOP LEVEL, at least not in production applications.</p>

<p>Unfortunately it has some other negative side effects as well. For instance, one can&#39;t as easily create a DSL-based scripting language out of Ruby because the DSL methods will end up in every object, which can cause unexpected consequences. One can work around this by using top level singleton methods instead, but then you have to make sure your users know this too and always prefix their methods with <code>self.</code>. Another issue is that <code>main</code> isn&#39;t even a full proxy for <code>Object</code>. For instance, try defining a dynamically named method at the top level using <code>define_method</code>.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">define_method</span><span class="p">(</span><span class="ss">:hello_world</span><span class="p">)</span> <span class="k">do</span>
  <span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span>  <span class="s2">&quot;Hello World&quot;</span>
  <span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">end</span>
  <span class="ss">NoMethodError</span><span class="p">:</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="sb">`define_method&#39; for main:Object</span>
</code></pre></div>
<p>For a very long time I have advocated that both of the these issues be banished by changing the top level into a self extended module instead of the current half-baked proxy. In effect:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">module</span> <span class="nn">MAIN</span>
    <span class="kp">extend</span> <span class="nb">self</span>
  <span class="k">end</span>
</code></pre></div>
<p>When a Ruby script is executed it would be executed within this MAIN namespace. With it, all expected functionality is available to us, such as <code>def</code>, as well as the module methods like <code>define_method</code>. Methods defined in MAIN would no longer invade every object, leaving us free to use the top level as serves our application best.</p>

<p>Some neat side effects of this approach include the ability to include MAIN in class definitions if it suits our usecase, as well as calling on methods defined on MAIN.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">Cool</span>
    <span class="k">def</span> <span class="nf">hello_world</span>
      <span class="k">if</span> <span class="no">MAIN</span><span class="o">.</span><span class="n">method_defined?</span><span class="p">(</span><span class="n">hello_world</span><span class="p">)</span>
        <span class="no">MAIN</span><span class="o">.</span><span class="n">hello_world</span>
      <span class="k">else</span>
        <span class="s2">&quot;Not so worldy, hello.&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>
<p>But by far my favourite use of such a design is the ability to use the top level for Ruby-based DSL scripting. For a familiar example consider Rake. Rake has a Rake::DSL module which is included in a special execution context where rakefiles are evaluated via special loading code. But with MAIN, it would be possible to mix Rake::DSL directly into it and then rakefiles could be loaded with a simple local <code>require</code>.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-17-June" title="June 17, 2012">June 17, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/06/14/autoload-smells-like-denmark/" rel="prefetch">Autoload Smells Like Denmark</a></h2>
            <p><h1>Autoload Smells Like Denmark</h1>

<p>Ruby has a very cool feature called <em>autoload</em>. With autoload, any undefined constant can automatically trigger the loading of a library file. Effectively this gives Ruby a convenient means of lazy loading. For example, lets say some of our app&#39;s executable scripts ultimately use the ANSI library, but others do not. We can use <code>autoload</code> to only load the ANSI library when it is needed.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="nb">autoload</span> <span class="no">ANSI</span><span class="p">,</span> <span class="s1">&#39;ansi&#39;</span>
</code></pre></div>
<p>This says to <code>require &quot;ansi&quot;</code> the first time an undefined ANSI constant is encountered.</p>

<p>As wonderful as autoload seems, it has too glaring issues: 1) It doesn&#39;t use standard Kernel#require and 2) It is not thread safe. </p>

<p>For the first, this means that any overriding of #require will not be supported by autoload. Of course such a thing is very rare, but it does occur. For instance the <a href="https://rubygems.org/gems/roll">Roll</a> library is all about overriding <code>#require</code>. Also RubyGems overrides #require, and in fact one can cause a bug to occur when using autoload because of it. Here&#39;s a very simple <a href="http://stackoverflow.com/questions/849622/autoload-raises-an-error-but-require-does-not-ruby">example</a>.</p>

<p>On the second case the issue seems much more complicated, and a solution seems so unlikely that Matz has called for #autoload to be <a href="http://bugs.ruby-lang.org/issues/5653">removed</a> from Ruby by v3.0.0. That&#39;s a long way off but just the same it doesn&#39;t bode well for autoload. </p>

<p>Now that Matz has effectively declared <code>#autoload</code> a code smell, I wonder if developers will take heed and stop using it? I have my doubts --it&#39;s just too damn convenient. I just wish it would use <code>Kernel#require</code> so I could use it along with Rolls.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-14-June" title="June 14, 2012">June 14, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
    <section class="pagination" style="text-align:center">
      
        
        <a href="/" class="btn btn-outline">‹ Newer</a>
        
      
      
        <a href="/page3" class="btn btn-outline">Older ›</a>
      
    </section>
</article>


<footer class="site-footer">
    <div class="container">
        &copy; 2014 
        
        <nav>
            <a href="http://transcode.github.com">TRANS</a> &middot;
            <a href="/">Blog</a> &middot;
            <a href="http://github.com/trans">Product</a> &middot; 
            <a href="/About/">About</a>
        </nav>
        
        <nav class="social">
            
            <a href="https://twitter.com/transgigamic" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
                
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
        <p>Incorporated theme by <a href="https://sendtoinc.com">Inc</a></p>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>


</body>
</html>
