<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>7R4N5.C0D3 - Ruby AOP Made Easy</title>

    <link rel="stylesheet" href="/smeagol/main.css" type="text/css"/> 
    <link rel="stylesheet" href="/smeagol/pygment.css" type="text/css"/>

    <link rel="stylesheet" href="/assets/styles/custom.css" type="text/css"/> 

    <!--[if lt IE 9]>
    <script src="/smeagol/html5.js"></script>
    <![endif]-->

    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

    <script src="/assets/scripts/main.js"></script>

    <script>
      $(document).ready(function(){
        show('#ad');
      });
    </script>

</head>

<body>
	
	
    <div id="container">
		<header>
			<h1>7R4N5.C0D3</h1>
		</header>

		<div id="nav">
      <li onMouseOver="show(this, '#am');">I AM</li>
      <li onMouseOver="show(this, '#make');">I MAKE</li>
      <li onMouseOver="show(this, '#ad');">I AD</li>
      <li onMouseOver="show(this, '#use');">I USE</li>
      <li onMouseOver="show(this, '#read');">I READ</li>
		</div>

    <div id="sidebar">
      <div id="am" class="tab">
        <h2 class="side-title">I Am</h2>
        <p>Trans has been coding Ruby since 2002. Now he shares with you. Kazaam!</p>
      </div>

      <div id="make" class="tab">
        <h2 class="side-title">I Make</h2>
        <div style="text-align: center;">
          <a href="http://rubyworks.github.com"><img src="/assets/images/rubyworks.png" style="width: 250px;" /></a>
          <a href="http://rubyworks.github.com/facets"><img src="/assets/images/RubyFacets.png" style="width: 270px;"/></a>
          <a href="http://death.rubyforge.org"><img src="/assets/images/skull4.png" style="margin-top: 0;"/></a>
        </div>
      </div>

      <div id="ad" class="tab">
        <h2 class="side-title">I Advertise</h2>
        <div style="text-align: center;">
          <script type="text/javascript"><!--
          google_ad_client = "pub-1126154564663472";
          /* RUBYWORKS 09-10-02 728x90 */
          google_ad_slot = "0788888658";
          google_ad_width = 728;
          google_ad_height = 90;
          //-->
          </script>
          <script type="text/javascript"
          src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
          </script>
        </div>
      </div>

      <div id="use" class="tab">
        <a href="http://ruby-lang.org"><img src="/assets/images/ruby-lang.png"/></a>
        <a href="http://github.org"><img src="/assets/images/github-logo.png" style="float: left; margin-left: 5px; width: 115px;"/></a>
        <a href="http://github.org"><img src="/assets/images/jquery-logo.gif" style="margin-left: 10px;"/></a>
        <a href="http://cukes.info/"><img src="/assets/images/cuke_logo.png"/></a>
      </div>

      <div id="read" class="tab">
        <h2 class="side-title">I Read</h2>
        <a href="http://rubyinside.com/"><img src="http://www.rubyinside.com/wp-content/themes/rubyinside2009/images/logo2.png" align="center"/></a>
      </div>

      <div id="work" class="tab">
        <h2 class="side-title">I Work</h2>
        <div id="github-badge"></div>
        <script type="text/javascript" charset="utf-8">
          GITHUB_USERNAME="trans";
        </script>
        <script src="http://drnic.github.com/github-badges/dist/github-badge-launcher.js" type="text/javascript"></script>
      </div>
    </div>

		<article>
			<h1>Ruby AOP Made Easy</h1>
    	<div id="content">
<h1>Ruby AOP Made Easy</h1>

<h2>Quick Recap</h2>

<p>Aspect Oriented Programming (AOP) is a topic I have spent a fair amount of
time contemplating. I, along with Peter VanBroekhoven, developed
the concept of Cut-based AOP back in <code>05-</code>06. A limited "toy" implementation of
which can be had by installing the <code>cuts</code> gem. The basic idea behind Cut-based
AOP is the <i>transparent subclass</i>, a.k.a. the <em>cut</em>, which is essentially
a subclass that subsumes the role of the class it effects without the programmer
needing any knowledge of it doing do. In this way, the cut serves as the atomic
construct in a purely object-oriented appraoch to AOP. You can read more about it
<a href="http://github.com/rubyworks/cuts/blob/master/RCR.textile">here</a>.</p>

<p>In dicussing this idea on the ruby-talk mailing list it was suggested that
an easier approach would be to forgo the Cut class and simply allow modules
to be "prepended" to the class or module to which they are applied. So for
instance we might write:</p>

<div class="highlight"><pre>    <span class="k">class</span> <span class="nc">C</span>
      <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="s2">"</span><span class="si">#{</span><span class="n">s</span><span class="si">}</span><span class="s2">"</span> <span class="p">;</span> <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">A</span>
      <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="s1">'{'</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">'}'</span> <span class="p">;</span> <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class</span> <span class="nc">C</span>
      <span class="n">prepend</span> <span class="n">A</span>
    <span class="k">end</span>

    <span class="n">C</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>  <span class="c1">#=&gt; "{hello}"</span>
</pre>
</div>


<p>Cut-based AOP is a general OOP design that can be applied to any
object-oriented programming language. But for Ruby, the idea of <code>prepend</code>,
while more limited, does serve much of the same purpose, and the idea is up for 
<a href="">consideration</a> in a future verison of Ruby.</p>

<h2>Another Way</h2>

<p>There is however another way to essentially use prepend-like AOP in Ruby without
extending Ruby in any special way. The trick is simply to design classes
and module to be "AOP-ready". Here is an example of the above using nothing
more than standard Ruby.</p>

<div class="highlight"><pre>    <span class="k">class</span> <span class="nc">C</span>
      <span class="k">module</span> <span class="nn">Joinable</span>
        <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="s2">"</span><span class="si">#{</span><span class="n">s</span><span class="si">}</span><span class="s2">"</span> <span class="p">;</span> <span class="k">end</span>
      <span class="k">end</span>
      <span class="kp">include</span> <span class="no">Joinable</span>
    <span class="k">end</span>

    <span class="k">module</span> <span class="nn">A</span>
      <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">s</span><span class="p">);</span> <span class="s1">'{'</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">'}'</span> <span class="p">;</span> <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">class</span> <span class="nc">C</span>
      <span class="kp">include</span> <span class="n">A</span>
    <span class="k">end</span>

    <span class="n">C</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>  <span class="c1">#=&gt; "{hello}"</span>
</pre>
</div>


<p>Pretty easy. We have simply encapsulate C's instance methods in a "Joinable"
module, thus any new inclusions into C itself will actually come <em>before</em>
these methods.</p>

<p>This of course raises the issue of including modules in the normal fashion,
in which case we would need in include them in Joinable itself, e.g.</p>

<div class="highlight"><pre>    <span class="k">class</span> <span class="nc">C</span>
      <span class="k">module</span> <span class="nn">Joinable</span>
        <span class="kp">include</span> <span class="no">Foo</span>
      <span class="k">end</span>
    <span class="k">end</span>
</pre>
</div>


<p>We could facilitate this will a little bit of Ruby magic.</p>

<div class="highlight"><pre>    <span class="k">class</span> <span class="nc">Module</span>
      <span class="n">alias_method</span> <span class="ss">:_include</span><span class="p">,</span> <span class="ss">:include</span>

      <span class="k">def</span> <span class="nf">include</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">const_defined?</span><span class="p">(</span><span class="ss">:Joinable</span><span class="p">)</span>
          <span class="n">core</span> <span class="o">=</span> <span class="nb">const_get</span><span class="p">(</span><span class="ss">:Joinable</span><span class="p">)</span>
          <span class="n">core</span><span class="o">.</span><span class="n">_include</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="n">_include</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">prepend</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">const_defined?</span><span class="p">(</span><span class="ss">:Joinable</span><span class="p">)</span>
          <span class="n">_include</span><span class="p">(</span><span class="o">*</span><span class="n">mods</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="k">raise</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">self</span><span class="si">}</span><span class="s2"> is not Joinable"</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
</pre>
</div>


<p>This is a very simplistic implementation, but a robust implementation would
be only slightly more complex. Now, as along as we use <code>Joinable</code>,
we can use #prepend.</p>

<hr /><p>title      : Ruby AOP Made Simple
author     : trans
date       : 2010-10-13
categories : [aop, cuts, ruby]
layout     : post</p>
			</div>
		</article>

		<footer>
			<small>Last edited by <b>7rans</b> on December 04, 2011.</small>
			<small style="float:right;">
				This site is a <a href="https://github.com/blog/699-making-github-more-open-git-backed-wikis">GitHub Wiki</a>
				mirror powered by <a href="http://smeagolrb.info">Smeagol</a>.
			</small>
		</footer>
    </div>
</body>
</html>
