<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>7R4N5.C0D3 - Do You Know Denumerable?</title>

    <link rel="stylesheet" href="/smeagol/main.css" type="text/css"/> 
    <link rel="stylesheet" href="/smeagol/pygment.css" type="text/css"/>

    <link rel="stylesheet" href="/assets/styles/custom.css" type="text/css"/> 

    <style>
      body{ color: #222; background: url(assets/images/bg.jpg); padding: 0; margin: 0; }

      header{ color: #222; height: 60px; margin: 0; padding: 30px 0; font-family: courier, monospace; font-size: 48px; }
      header h1 { margin-top: 20px; color: #222; text-shadow: 0px 0px 5px #555; }
      header h2 { color: #cccccc; text-shadow: 0px 0px 5px black; padding: 5px 0 20px 15px; }

      nav{ padding: 1em; background: #000; opacity: 0.8; border: none; }
      nav ul li a{ color: #eee; }
      nav ul li a:hover{ color: #59c; }

      #content{ color: #222; padding: 1em; width: 550px; margin: 0; background: #fff; }
      #content h1 { color: #222; }
      #content h2 { color: #222; }
      #content p { color: #222; }

      #sidebar{margin-bottom: 20px; padding: 20px; background: #fff; border: 1px solid #ccc; min-height: 100px; box-shadow: 5px 5px 10px #ccc; }
      #sidebar h1,h2 { font-family: times; }
      #sidebar h2 { font-size: 2em; margin: 10px 0 10px 0; }

      footer{width: 550px; color:#222; margin-top:20px; padding:20px; border:none; background:#fff; }

      #container{ margin: 0 auto; padding 0; width: 900px; }

      .tab { display: none; }
    </style>

    <!--[if lt IE 9]>
    <script src="/smeagol/html5.js"></script>
    <![endif]-->

    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

    <script>
      $(document).ready(function(){
        show('#ad');
      });
    </script>

    <script>
      function show(id){
        $('.tab').hide();
        $(id).fadeIn();
      };
    </script>

</head>

<body>
	
	
    <div id="container">
		<header>
			<h1>7R4N5.C0D3</h1>
		</header>

		<nav>
      <button onMouseOver="show('#am');">I AM</button>
      <button onMouseOver="show('#make');">I MAKE</button>
      <button onMouseOver="show('#ad');">I AD</button>
      <button onMouseOver="show('#use');">I USE</button>
      <button onMouseOver="show('#read');">I READ</button>
		</nav>

    <div id="sidebar">
      <div id="am" class="tab">
        <h2 class="side-title">I Am</h2>
        <p>Trans has been coding Ruby since 2002. Now he shares with you. Kazaam!</p>
      </div>

      <div id="make" class="tab">
        <h2 class="side-title">I Make</h2>
        <div style="text-align: center;">
          <a href="http://rubyworks.github.com"><img src="/assets/images/rubyworks.png" style="width: 250px;" /></a>
          <a href="http://rubyworks.github.com/facets"><img src="/assets/images/RubyFacets.png" style="width: 270px;"/></a>
          <a href="http://death.rubyforge.org"><img src="/assets/images/skull4.png" style="margin-top: 0;"/></a>
        </div>
      </div>

      <div id="ad" class="tab">
        <h2 class="side-title">I Advertise</h2>
        <div style="text-align: center;">
          <script type="text/javascript"><!--
          google_ad_client = "pub-1126154564663472";
          /* RUBYWORKS 09-10-02 728x90 */
          google_ad_slot = "0788888658";
          google_ad_width = 728;
          google_ad_height = 90;
          //-->
          </script>
          <script type="text/javascript"
          src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
          </script>
        </div>
      </div>

      <div id="use" class="tab">
        <h2 class="side-title">I Use</h2>
        <a href="http://ruby-lang.org"><img src="/assets/images/ruby-lang.png"/></a>
        <a href="http://github.org"><img src="/assets/images/github-logo.png" style="float: left; margin-left: 5px; width: 115px;"/></a>
        <a href="http://github.org"><img src="/assets/images/jquery-logo.gif" style="margin-left: 10px;"/></a>
        <a href="http://cukes.info/"><img src="/assets/images/cuke_logo.png"/></a>
      </div>

      <div id="read" class="tab">
        <h2 class="side-title">I Read</h2>
        <a href="http://rubyinside.com/"><img src="http://www.rubyinside.com/wp-content/themes/rubyinside2009/images/logo2.png" align="center"/></a>
      </div>

      <div id="work" class="tab">
        <h2 class="side-title">I Work</h2>
        <div id="github-badge"></div>
        <script type="text/javascript" charset="utf-8">
          GITHUB_USERNAME="trans";
        </script>
        <script src="http://drnic.github.com/github-badges/dist/github-badge-launcher.js" type="text/javascript"></script>
      </div>
    </div>

		<article>
			<h1>Do You Know Denumerable?</h1>
    	<div id="content">
<h1>Do You Know Denumerable?</h1>

<p>All Rubyists know and love Enumerable. It's the really the showcase of Ruby's mixin system. Some Rubyists also know and appreciate <a href="http://moonbase.rydia.net/software/lazy.rb/">lazy.rb</a> MenTaLguY's excellent lazy evaluation library. But did you know there is library that essentially cross-breeds the ideas of both? It's called Denumerable(<a href="http://github.com/rubyworks/facets/blob/master/lib/core/facets/denumerable.rb">http://github.com/rubyworks/facets/blob/master/lib/core/facets/denumerable.rb</a>) and is included in Ruby Facets (<code>require 'facets/denumerable'</code>).</p>

<p>According to Webster's The term <code>denumerable</code> is just a synonym for <code>enumerable</code>. In Ruby parlance, it takes a more useful distinction of "deferred enumerable". In other words Denumerable defers actual calculations of a chain of enumerable method calls until the results are actually needed. That's where the "laziness" comes in. By deferring calculation Ruby is able to optimize the algorithm, in many cases greatly improving performance. It's even possible to enumerate infinite ranges if the end result itself is finite.</p>

<p>To make it even more convenient there is <a href="http://github.com/rubyworks/facets/blob/master/lib/core/facets/enumerable/defer.rb">Enumerable#defer</a> (<code>require 'facets/enumerable/defer'</code>) which delegates an Enumerable object through a Denumerator, just like Ruby's core Enumerator class.</p>

<p>So, enough talk, right? How about an example.</p>

<div class="highlight"><pre>    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">1_000_000_000</span><span class="p">)</span><span class="o">.</span><span class="n">defer</span><span class="o">.</span><span class="n">select</span><span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span><span class="o">.</span>
                                 <span class="n">map</span><span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">100</span> <span class="p">}</span><span class="o">.</span>
                                 <span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
    <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">120</span><span class="o">]</span>
</pre>
</div>


<p>The performance gains of Denumerable cannot be understated. The above example takes 1/10000th of a second to run on my system. I wanted to provide the time it takes to run without <code>defer</code>, but after an hour of waiting and listening to it eat my hard drive for breakfast, I gave up.</p>
			</div>
		</article>

		<footer>
			<small>Last edited by <b>7rans</b> on December 03, 2011.</small>
			<small style="float:right;">
				This site is a <a href="https://github.com/blog/699-making-github-more-open-git-backed-wikis">GitHub Wiki</a>
				mirror powered by <a href="http://smeagolrb.info">Smeagol</a>.
			</small>
		</footer>
    </div>
</body>
</html>
