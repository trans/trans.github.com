<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>2012 04 13 peanut butter and chocolate handlebars\7R4N5C0D3</title>
  <meta name="author" content="Trans" />

  <link rel="icon" type="image/png" href="/assets/images/trans-logo.png">

  <link rel="stylesheet" href="/assets/styles/main.css" type="text/css"/> 
  <link rel="stylesheet" href="/assets/styles/code.css" type="text/css"/>  
  <link rel="stylesheet" href="/assets/styles/pygment.css" type="text/css"/>

  <link rel="stylesheet" href="/assets/styles/custom.css" type="text/css"/>
  <link rel="stylesheet" href="/assets/styles/social.css" type="text/css"/>  

  <link href='http://fonts.googleapis.com/css?family=Jura:400,500' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>

  <!--[if lt IE 9]>
  <script src="/scripts/html5.js"></script>
  <![endif]-->

  <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

  <script type="text/javascript" src="/assets/scripts/jquery.easing.js"></script>
  <script type="text/javascript" src="/assets/scripts/jquery.social.share.1.2.min.js"></script>

  <script src="/assets/scripts/main.js"></script>

  <script>
    $(document).ready(function(){
      $('#social-share').dcSocialShare({
        twitterId: 'transgigamic',
        tabText: '<img src="/assets/images/tab_share.png" alt="Share" />',
        buttons: 'twitter,facebook,plusone,stumbleupon,digg,linkedin,pinit'
      });
    });
  </script>

  <!-- tracking code here ? -->
</head>

<body>
<div id="container">

	<div id="header">
		<h1>7R4N5C0D3</h1>
	</div>

	<div id="nav">
    <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/Projects">Projects</a></li>
    <li><a href="/Reads">Reads</a></li>
    <li><a href="/Tools">Tools</a></li>
    <li><a href="/tags.html">Tags</a></li>
    <li><a href="/atom.xml">Feed</a></li>
    <li><a href="https://github.com/trans/trans.github.com/wiki">Wiki</a> &gt;&gt;</li>
    </ul>
	</div>

<!-- CONTENT -->
<div id="content-wrapper">
<div id="content">

<h1>Peanut Butter and Chocolate Handlebars</h1>

<p>This week I've been working on the <a href="http://github.com/rubyworks/shomen">Shomen</a> documentation project. In particular I've been converting the templates of my three web-based documentation viewers to compiled templates in order to boost rendering speed. Originally these viewers were using <a href="http://aefxx.com/jquery-plugins/jqote2/">jqote2</a> in one case (<a href="http://github.com/rubyworks/hypervisor">hypervisor</a>) and <a href="https://github.com/jquery/jquery-tmpl">jquery-tmpl</a> in the other two cases (<a href="http://github.com/rubyworks/rebecca">rebecca</a> and <a href="http://github.com/rubyworks/rubyfaux">rubyfaux</a>). While ascertaining what compilation solution to use, I tried the <a href="https://github.com/wookiehangover/jquery-tmpl-jst">jquery-tmpl-jst</a> for the later two, but immediately ran into fundamental errors. (Sorry, I don't recollect exactly what the errors were now). They were problematic enough to send me looking else where, and ultimately I decided on <a href="http://handlebarsjs.com/">Handlebars.js</a>.</p>

<p>Handlebars is great... mostly. Handlebars a variant of <a href="http://mustache.github.com/">Mustache</a> and is billed like Mustache as "logic-less" templates. But, whereas Mustache is <em>pure</em> about this ideal, Handlebars backs off a bit and at least allows some computation to take place via helpers. Unfortunately, from my experience I have found the ideal of "logic-less" templates to be largely misplaced, and not even Handlebars goes far enough to rectify the situation. What one ends up doing is just moving the "logic" to a separate file where it mostly consists of bits of trivial code and where it is more difficult to maintain because it is separated from the specific bit of markup it supports.</p>

<p>Take this example. It's the last bit of jqeury-tmpl I needed to convert to Handlebars for rubyfaux.</p>

<div class="highlight">
<pre>{{if methods.length}}
  ${divy  = Rubyfaux.divy_methods(methods),''}
  ${scope = ['class','instance'],''}
  ${sight = ['public','protected','private'],''}

  {{each(i,s) scope}}
    {{each(j,v) sight}}
      {{if divy[s][v].length &gt; 0}}
        <span class="nt">&lt;h3&gt;</span>${v.capitalize()} ${s.capitalize()} METHODS<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"reference-list"</span><span class="nt">&gt;</span>
        {{each(k,m) divy[s][v]}}
          {{tmpl(m) "#template-method"}}
        {{/each}}
        <span class="nt">&lt;/ul&gt;</span>
      {{/if}}
    {{/each}}
  {{/each}}
{{/if}}
</pre>
</div>


<p>How does one translate this to Handlbars.js? It isn't a straight forward process. Handlebars doesn't allow the embedded assignments. So right off we see that <code>scope</code> and <code>sight</code> must be extracted. Secondly, the fact that some of the template is only shown if the combination of <code>scope</code> and <code>sight</code> has any entries, means this can't be rendered via a single Handlebars block helper. It has to be broken up so we can use a helper to render only if there are entries for each combination. But then it becomes difficult, if not impossible, to loop over <code>scope</code> and <code>sight</code> to keep our code DRY. Instead we end up with something like:</p>

<div class="highlight">
<pre>{{#methods_categorized}}

  {{#if_methods_by "class" "public"}}
    <span class="nt">&lt;h3&gt;</span>PUBLIC CLASS METHODS<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"reference-list"</span><span class="nt">&gt;</span>
    {{#class}}
      {{#public}}
        {{&gt; method}}
      {{/public}}
    {{/class}}
  {{/if_methods_by}}

  ... ditto for each combination of scope and sight ...

{{/methods_categorized}}
</pre>
</div>


<p>Thank goodness there are only six combinations!</p>

<p>Of course, there is a way around this explosion in code. We can use a single block helper, but only if we render the <code>h3</code> and <code>ul</code> tags via the block helper too.</p>

<div class="highlight">
<pre><span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span><span class="p">(</span><span class="s1">'methods_categorized'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">meths</span> <span class="o">=</span> <span class="nx">Rubyfaux</span><span class="p">.</span><span class="nx">divy_methods</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">methods</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">scope</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'class'</span><span class="p">,</span><span class="s1">'instance'</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">sight</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span><span class="s1">'protected'</span><span class="p">,</span><span class="s1">'private'</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">sight</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">combination</span> <span class="o">=</span> <span class="nx">meths</span><span class="p">[</span><span class="nx">scope</span><span class="p">[</span><span class="nx">i</span><span class="p">]][</span><span class="nx">sight</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">combination</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s2">"&lt;h3&gt;"</span> <span class="o">+</span> <span class="nx">scope</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">sight</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">" METHODS&lt;/h3&gt;\n"</span><span class="p">;</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s1">'&lt;ul class="reference-list"&gt;'</span> <span class="o">+</span> <span class="s2">"\n"</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">combination</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="nx">block</span><span class="p">(</span><span class="nx">meths</span><span class="p">);</span>
          <span class="p">};</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s2">"\n&lt;/ul&gt;"</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>    
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
<span class="p">});</span>
</pre>
</div>


<p>Then our Handlebars template becomes the very simple:</p>

<div class="highlight">
<pre>{{#methods_categorized}}
  {{&gt; method}}
{{/methods_categorized}}
</pre>
</div>


<p>But what on earth have we done!? Pursuing the ideal of keeping our views cleansed of logic, and DRY, we've ended up putting our view in our logic! You would think this is an obvious "no no" too, but look at some of the examples on <a href="http://handlebarsjs.com/">Handlebars.js</a> website and you will see they do this quite regularly.</p>

<p>Perhaps there is a more appropriate way to handle the above example, and I am all ears. But after giving the whole concept of keeping logic completely out of views, I've come to the conclusion that it's really not so ideal. Like Reese's mixing chocolate and peanut butter, mixing views and logic can be a good thing. The trick is limiting the logic to particular domains, let's call it "view logic" as opposed to "data logic".</p>

<p>View logic should be limited to these purposes:</p>

<ul>
<li>Conditions</li>
<li>Sorting</li>
<li>Categorizing</li>
<li>Formatting</li>
</ul><p>By limiting view logic to these, I'd say we have still achieved the ideal of "logic-less templates". By being zealots about the logic-less concept we end-up just creating the opposite problem of mixing our templates into our logic, which is just as bad, if not worse. Template engines, like Handlebars.js, would do well to take this into account and expand their capabilities to include more flexible conditions, sorting, categorizing and formatting constructs and helpers out of the box.</p>

<!--
<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    {% for post in site.related_posts limit:3 %}
      <li><span class="post-date">July 07, 2012</span> &raquo; <a href="">2012 04 13 peanut butter and chocolate handlebars</a></li>
    {% endfor %}
  </ul>
</div>
-->

</div>
</div>
<!-- END CONTENT -->

<!-- Start Shareaholic Sexybookmarks -->
<div class="shr_class shareaholic-show-on-load">
</div>

<script type="text/javascript">
var SHRSB_Settings = {"shr_class":{"src":"/assets/shareaholic","link":"","service":"236,45,5,7,88,92,61,204,202,102,3,40,10,2,38,195,27,48,6,1,218,24,46,267,74,191,265,219,210,78,240,207,54,53,52,201","apikey":"6ffe2cbf142c45bd4cd03b01ec46b8658","localize":true,"shortener":"google","shortener_key":"","designer_toolTips":true,"twitter_template":"${title} - ${short_link} via @Shareaholic"}};
</script>

<script type="text/javascript">
(function() {
var sb = document.createElement("script"); sb.type = "text/javascript";sb.async = true;
sb.src = ("https:" == document.location.protocol ? "https://dtym7iokkjlif.cloudfront.net" : "http://cdn.shareaholic.com") + "/media/js/jquery.shareaholic-publishers-sb.min.js";
var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(sb, s);
})();
</script>
<!-- End Shareaholic Sexybookmarks -->

<!-- Start Disqus Commments -->
<div id="comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /**
     * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread] 
     */
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = 'http://transcode.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=transcode">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
<!-- End Disqus Commands -->

<div id="social-share"></div>

<!-- FOOTER -->

<div id="footer">
  <div class="tiger">
  </div>
	<small>Last edited by <b>trans</b> on July 07, 2012.</small>
	<small style="float:right;">
		This site is a <a href="https://github.com/blog/699-making-github-more-open-git-backed-wikis">GitHub Wiki</a>
		mirror powered by <a href="http://rubyworks.github.com/smeagol">Smeagol</a>.
	</small>
</div>

</div>
</body>
</html>

