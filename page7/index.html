<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRANSCODE &mdash; Trans Technology and Programming Blog</title>
    <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/trans-logo.png"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="TRANSCODE" />
    <meta name="title" content="TRANSCODE">
    <link rel="canonical" href="http://trans.github.com/page7/">
     
           
    <meta property="og:title" content="TRANSCODE"/>
    <meta property="og:url" content="http://trans.github.com/page7/"/>
    
    
    <meta property="og:site_name" content="TRANSCODE">
</head>
<body>
    
<section class="site-nav">
    <header>
        <nav id="navigation">
            <a class="brand" href="/">
                <img src="/images/trans-logo.png" alt="Inc" height="120px">
            </a>
            <a href="/" class="home">Blog</a>
            <a href="http://github.com/trans">Github</a>
            <a href="/About/">About</a>
        </nav>
        <nav class="tagline">
            <span>Check out all of my open source work</span>
            <a href="http://github.com/trans" class="btn btn-outline">Learn More</a>
        </nav>
    </header>
</section>

<div class="blog-cover" style="background-image:url(/images/blog-cover.jpg);">
    
    <section>
        <div class="container">
            <h1>TRANSCODE</h1>
            <h3>Trans Technology and Programming Blog</h3>
        
            
            <a href="https://twitter.com/transgigamic" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter"></i></a>
            
            
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss"></i>
            </a>
        </div>
    </section>
</div>

<article class="container">

  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2008/09/12/taskable/" rel="prefetch">Taskable</a></h1>
            <p><h1>Taskable</h1>

<p>On more than a few occasions I have taken a stab at writing a general
purpose task system, akin to Rake&#39;s, but one that works within the
framework of Ruby class inheritance. I recall my first attempt was
quite an unwieldy beast, and my subsequent attempts were fairly
unwieldy too, but over time they became more concise. Below is the
most concise variation yet, and I was wondering what other thought
of it -- do you see any flaws in the design; does it satisfy all the
criteria of such a system; would you find it useful; etc.</p>

<p>One issue to note about the code, is the use of the <code>*_trigger</code> methods.
I&#39;m not sure that&#39;s the best approach. My original approach was
to provide a #run method (you can see it commented out), but this
requires dividing Taskable into two parts, a module for extending and
a module for including, and I try to avoid that design when I can.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="k">module</span> <span class="nn">Taskable</span>

      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">append_features</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">base</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
      <span class="k">end</span>

      <span class="c1"># Without an argument, returns list of tasks defined for this class.</span>
      <span class="c1">#</span>
      <span class="c1"># If a task&#39;s target name is given, will return the first</span>
      <span class="c1"># task matching the name found in the class&#39; inheritance chain.</span>
      <span class="c1"># This is important to ensure tasks are inherited in the same manner</span>
      <span class="c1"># that methods are.</span>
      <span class="k">def</span> <span class="nf">tasks</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="kp">nil</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span>
          <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">to_sym</span>
          <span class="n">anc</span> <span class="o">=</span> <span class="nb">ancestors</span><span class="o">.</span><span class="n">select</span><span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="no">Taskable</span><span class="p">}</span> <span class="c1">#DSL</span>
          <span class="n">t</span> <span class="o">=</span> <span class="kp">nil</span><span class="p">;</span> <span class="n">anc</span><span class="o">.</span><span class="n">find</span><span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="n">t</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">tasks</span><span class="o">[</span><span class="n">target</span><span class="o">]</span><span class="p">}</span>
          <span class="k">return</span> <span class="n">t</span>
        <span class="k">else</span>
          <span class="vi">@tasks</span> <span class="o">||=</span> <span class="p">{}</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="c1"># Set a description to be used by then next defined task in this class.</span>
      <span class="k">def</span> <span class="nf">desc</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
        <span class="vi">@desc</span> <span class="o">=</span> <span class="n">description</span>
      <span class="k">end</span>

      <span class="c1"># Define a task.</span>
      <span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="n">target_and_requisite</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">function</span><span class="p">)</span>
        <span class="n">target</span><span class="p">,</span> <span class="n">requisite</span><span class="p">,</span> <span class="n">function</span> <span class="o">=</span> <span class="o">*</span><span class="no">Task</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">(</span><span class="n">target_and_requisite</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">function</span><span class="p">)</span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">[</span><span class="n">target</span><span class="o">.</span><span class="n">to_sym</span><span class="o">]</span> <span class="o">||=</span> <span class="p">(</span>
          <span class="n">tdesc</span> <span class="o">=</span> <span class="vi">@desc</span>
          <span class="vi">@desc</span> <span class="o">=</span> <span class="kp">nil</span>
          <span class="no">Task</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">tdesc</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">task</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">requisite</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">function</span><span class="p">)</span>
        <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">target</span><span class="si">}</span><span class="s2">_trigger&quot;</span><span class="p">){</span> <span class="n">task</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="p">}</span>  <span class="c1"># or use #run?</span>
        <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">target</span><span class="si">}</span><span class="s2">:task&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">function</span><span class="p">)</span> <span class="c1"># TODO: in 1.9 use instance_exec instead.</span>
      <span class="k">end</span>

      <span class="c1"># Run a task.</span>
      <span class="c1"># Hmmm... to add this would require another module (to include).</span>
      <span class="c1"># But I&#39;m not sure. Maybe trigger method is the better way?</span>
      <span class="c1">#</span>
      <span class="c1">#def run(target)</span>
      <span class="c1">#  #t = self.class.tasks(target)</span>
      <span class="c1">#  #t.run(self)</span>
      <span class="c1">#  send(&quot;#{target}_trigger&quot;)</span>
      <span class="c1">#end</span>

      <span class="c1"># = Task Class</span>
      <span class="c1">#</span>
      <span class="k">class</span> <span class="nc">Task</span>
        <span class="kp">attr</span> <span class="ss">:base</span>
        <span class="kp">attr</span> <span class="ss">:target</span>
        <span class="kp">attr</span> <span class="ss">:requisite</span>
        <span class="kp">attr</span> <span class="ss">:function</span>
        <span class="kp">attr</span> <span class="ss">:description</span>

        <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="n">requisite</span><span class="o">=</span><span class="kp">nil</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">function</span><span class="p">)</span>
          <span class="vi">@base</span>        <span class="o">=</span> <span class="n">base</span>
          <span class="vi">@target</span>      <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">to_sym</span>
          <span class="vi">@description</span> <span class="o">=</span> <span class="n">description</span>
          <span class="vi">@requisite</span>   <span class="o">=</span> <span class="n">requisite</span> <span class="o">||</span> <span class="o">[]</span>
          <span class="vi">@function</span>    <span class="o">=</span> <span class="n">function</span>
        <span class="k">end</span>

        <span class="c1">#</span>
        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">requisite</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">function</span><span class="p">)</span>
          <span class="vi">@requisite</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">requisite</span><span class="p">)</span><span class="o">.</span><span class="n">uniq!</span>
          <span class="vi">@function</span> <span class="o">=</span> <span class="n">function</span> <span class="k">if</span> <span class="n">function</span>
        <span class="k">end</span>

        <span class="c1">#</span>
        <span class="k">def</span> <span class="nf">prerequisite</span>
          <span class="n">base</span><span class="o">.</span><span class="n">ancestors</span><span class="o">.</span><span class="n">select</span><span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span> <span class="n">a</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="no">Taskable</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">collect</span><span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span>
            <span class="n">a</span><span class="o">.</span><span class="n">tasks</span><span class="o">[</span><span class="n">target</span><span class="o">].</span><span class="n">requisite</span>
          <span class="p">}</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">uniq</span>
        <span class="k">end</span>

        <span class="c1"># invoke target</span>
        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">object</span><span class="p">)</span>
          <span class="n">rd</span> <span class="o">=</span> <span class="n">rule_dag</span>
          <span class="n">rd</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
            <span class="n">object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">t</span><span class="si">}</span><span class="s2">:task&quot;</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="c1">#</span>
        <span class="c1">#def call(object)</span>
        <span class="c1">#  object.instance_eval(&amp;function)</span>
        <span class="c1">#end</span>

        <span class="c1"># Collect task dependencies for running.</span>
        <span class="k">def</span> <span class="nf">rule_dag</span><span class="p">(</span><span class="n">cache</span><span class="o">=[]</span><span class="p">)</span>
          <span class="n">prerequisite</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
            <span class="k">next</span> <span class="k">if</span> <span class="n">cache</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">tasks</span><span class="o">[</span><span class="n">r</span><span class="o">]</span>
            <span class="n">t</span><span class="o">.</span><span class="n">rule_dag</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
            <span class="c1">#cache &lt;&lt; dep</span>
          <span class="k">end</span>
          <span class="n">cache</span> <span class="o">&lt;&lt;</span> <span class="n">target</span><span class="o">.</span><span class="n">to_s</span>
          <span class="n">cache</span>
        <span class="k">end</span>

        <span class="c1">#</span>
        <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">parse_arguments</span><span class="p">(</span><span class="n">name_and_reqs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">action</span><span class="p">)</span>
          <span class="k">if</span> <span class="no">Hash</span><span class="o">===</span><span class="n">name_and_reqs</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">name_and_reqs</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">to_s</span>
            <span class="n">reqs</span> <span class="o">=</span> <span class="o">[</span><span class="n">name_and_reqs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">first</span><span class="o">].</span><span class="n">flatten</span>
          <span class="k">else</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">name_and_reqs</span><span class="o">.</span><span class="n">to_s</span>
            <span class="n">reqs</span> <span class="o">=</span> <span class="o">[]</span>
          <span class="k">end</span>
          <span class="k">return</span> <span class="n">target</span><span class="p">,</span> <span class="n">reqs</span><span class="p">,</span> <span class="n">action</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre></div>
<p>Here&#39;s a very simple <a href="http://quarry.rubyforge.org">QEDoc</a> demo/spec:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">Example</span>
      <span class="kp">include</span> <span class="no">Taskable</span>

      <span class="n">task</span> <span class="ss">:task_with_no_requisites</span> <span class="k">do</span>
        <span class="n">cache</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;task_with_no_requisites&quot;</span>
      <span class="k">end</span>

      <span class="n">task</span> <span class="ss">:task_with_one_requisite</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:task_with_no_requisites</span><span class="o">]</span> <span class="k">do</span>
        <span class="n">cache</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;task_with_one_requisite&quot;</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">cache</span>
        <span class="vi">@cache</span> <span class="o">||=</span> <span class="o">[]</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">example</span> <span class="o">=</span> <span class="no">Example</span><span class="o">.</span><span class="n">new</span>
    <span class="c1">#example.run :task_with_no_requisites</span>
    <span class="n">example</span><span class="o">.</span><span class="n">task_with_no_requisites_trigger</span>
    <span class="n">example</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">assert</span> <span class="o">==</span> <span class="o">[</span><span class="s2">&quot;task_with_no_requisites&quot;</span><span class="o">]</span>

    <span class="n">example</span> <span class="o">=</span> <span class="no">Example</span><span class="o">.</span><span class="n">new</span>
    <span class="c1">#example.run :task_with_one_requisite</span>
    <span class="n">example</span><span class="o">.</span><span class="n">task_with_one_requisite_trigger</span>
    <span class="n">example</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">assert</span> <span class="o">==</span> <span class="o">[</span><span class="s2">&quot;task_with_no_requisites&quot;</span><span class="p">,</span> <span class="s2">&quot;task_with_one_requisite&quot;</span><span class="o">]</span>
</code></pre></div>
<p>So, what do you think?</p>

<hr>

<p>title      : Taskable
date       : 2008-09-12
categories : [ruby]
layout     : post</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2008-12-September" title="September 12, 2008">September 12, 2008</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2007/05/02/the-library-poll/" rel="prefetch">The Library Poll</a></h1>
            <p><h1>The Library Poll</h1>

<p>I&#39;ve been thinking far too long about how best to organize and distribute programming libraries. Having a hard time coming to any firm conclusions, I&#39;ve decided to try an inductive approach --via a poll. If you have a moment, I&#39;d really appreciate your thoughtful answers to the following questions. Thanks!</p>

<p><strong>Sorry, the polls are closed</strong>. But here are the results:</p>

<p>1) Which library name would you prefer: (<code>126</code> votes)</p>

<ul>
<li><code>37%</code> livelibs-file</li>
<li><code>63%</code> filestorm</li>
</ul>

<p>2) Which library would you be more likely to try: (<code>204</code> votes)</p>

<ul>
<li><code>62%</code> cliutils</li>
<li><code>10%</code> cli/best</li>
<li><code>03%</code> cliBest</li>
<li><code>24%</code> climax</li>
</ul>

<p>3) Should programming libraries be named: (<code>211</code> votes)</p>

<ul>
<li><code>45%</code> Creatively</li>
<li><code>55%</code> Categorically</li>
</ul>

<p>4) Programming libraries should be packaged: (<code>200</code> votes)</p>

<ul>
<li><code>35%</code> Per specific tool</li>
<li><code>47%</code> Per related set of tools</li>
<li><code>18%</code> Comprehensively (all-in-one)</li>
</ul>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2007-02-May" title="May 02, 2007">May 02, 2007</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2007/03/12/package-management-is-a-red-herring/" rel="prefetch">Package Management Is A Red Herring</a></h1>
            <p><h1>Package Management is a Red Herring</h1>

<p>Traditionally package management has been fairly complicated. Developers must navigate the matrix of platform support, package format and configuration choices that are often as time consuming as they are restrictive. </p>

<p>For instance, the goto format of the day on most Linux platforms is the Debian package format. Debian packages follow closely to the <code>FHS</code> (File Hierarchy standard), and tend to enforce fairly strict Debian packaging policies, such as placing development files in separate packages. Debian packages require the creation of a control file with information about the build as well as a &quot;fuax installation&quot; that is packaged up into a <code>.deb</code> file. All of this takes a fair bit of effort on the developer&#39;s part. And that&#39;s just the work involved for supporting one package format for a limited selection of platforms.</p>

<p>For Ruby developers, RubyGems has come along to make life a fair bit easier. They have dispensed with FHS compliance, to the dismay if Debian maintainers, and provided a relatively easy means of packaging up a library or application for redistribution by following the <em>convention over configuration</em> philosophy. Of course, it helps that the target source is Ruby, which has very simple file-based import system, as opposed to C or Java.</p>

<p>Even so, package management can be even easier if we simply recognize the gorilla in the room: version control systems. All developers now use source code managers (<code>SCM</code>) to track changes to code and <em>distribute</em> source between developers. See the keyword there? The ability to <em>distribute</em> a program is half the battle of package management.</p>

<p>The other half is installation. For a pure-Ruby program installation if fairly trivial, it&#39;s just a matter to putting the files in a proper location on the file system. For C or Java packages there is the further matter of the <em>compile</em>. For open-source projects that&#39;s not particularly difficult, a build script can be provided and as long as the end installer has the necessary build tools, the program can be compiled on demand. For proprietary code it gets more complicated, but lets put that aside for the moment.</p>

<p>Taking all of this into consideration, packaging systems should be fairly trivial --a wrapper around SCM tools that pull down the current or tagged version of source, run the build script and copy the resulting files to an appropriate place on disk. Such a system would be very light weight. In fact, with the exception of dependency management code, there&#39;s no reason that such a system to take up more than a few hundred lines of code.</p>

<p>The question of proprietary code is a little more challenging since the developer does not want the source code to make it&#39;s way to the end-users system at all. In this case I suggest one of two possibilities: 1) it may be possible to use encryption to prevent end-users from gaining access to the source, or 2) use an intermediary service that builds a package on a replica of the end users machine, turning over only the final results. Yes, this means complications for proprietary vendors, but it&#39;s one that could easily be turned into a service.</p>

<p>The chore of the developer could then be greatly reduced to following a set of standards for organizing a project, providing metadata and optionally a build script for handling advanced build requirements. The target platform can take these pieces and build and install the package as is suitable to the platform. In other words, the platform takes care of the platform distinctions, not the developer.</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2007-12-March" title="March 12, 2007">March 12, 2007</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2006/12/03/negative-arrays/" rel="prefetch">Negative Arrays</a></h1>
            <p><h1>Negative Arrays</h1>

<p>My current work involves the creation of an extensive configuration file format representing project information. In a number of cases I have had need of an inclusion list, representing files and file patterns to include for some operation --say, what files to include in a package. In such a case I generally end up with a least two parameters which I basically label include and exclude. While include is the list of files to use, exclude is list of files to exclude from the included list. Using exclude makes it easier to specify a large selection and then subsequently omit a file or two. The include list typically has a suitable default value, so a third parameter is sometimes also of use, append, which concats to the defaults as opposed to replacing the include parameter outright.</p>

<p>Since these three parameters help define what is essentially one list of data, it would be nice if they could be specified as a single parameter too. So I gave the problem some thought.</p>

<p>Taking inspiration from the notion of a negated symbol (see facets/symbol/not). It occurred to me that any object that can be added or subtracted is taking part in the same &quot;algebraic group&quot; as whole numbers. And just as a whole number can be negative, why not also an array?</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="n">a</span> <span class="o">=</span>  <span class="o">[</span><span class="ss">:a</span><span class="p">,</span><span class="ss">:b</span><span class="p">,</span><span class="ss">:c</span><span class="p">,</span><span class="ss">:d</span><span class="p">,</span><span class="ss">:e</span><span class="o">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="o">-[</span><span class="ss">:d</span><span class="p">,</span><span class="ss">:e</span><span class="o">]</span>
    <span class="n">a</span> <span class="o">+</span> <span class="n">n</span> <span class="c1">#=&gt; [:a,:b,:c]</span>
</code></pre></div>
<p>So this could be very helpful. And it shouldn&#39;t be too much hard to implement.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="k">class</span> <span class="nc">Array</span>
      <span class="k">def</span> <span class="err">@</span><span class="o">-</span>
        <span class="vi">@negative</span> <span class="o">=</span> <span class="o">!</span><span class="vi">@negative</span>
        <span class="nb">self</span>
      <span class="k">end</span>

      <span class="k">def</span> <span class="nf">negative?</span>
        <span class="vi">@negative</span>
      <span class="k">end</span>

      <span class="k">alias</span> <span class="ss">:add</span> <span class="ss">:+</span>
      <span class="k">alias</span> <span class="ss">:sub</span> <span class="ss">:-</span>

      <span class="k">def</span> <span class="nf">+</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">negative?</span>
          <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">negative?</span>
            <span class="o">-</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
          <span class="k">else</span>
            <span class="o">-</span><span class="nb">sub</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">else</span>
          <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">negative?</span>
            <span class="nb">sub</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
          <span class="k">else</span>
            <span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>

      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="k">end</span>
</code></pre></div>
<p>I&#39;m sure tighter implementation is possible, but you get the idea. So then include and exclude parameters could be specified in a single parameter.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="n">files</span> <span class="o">=</span> <span class="o">[</span> <span class="s1">&#39;**/*&#39;</span><span class="p">,</span> <span class="o">-[</span> <span class="s1">&#39;Installedfiles&#39;</span> <span class="o">]</span> <span class="o">]</span>
</code></pre></div>
<p>Neat! But unfortunately it doesn&#39;t really solve the whole problem since YAML doesn&#39;t understand this negative listing concept either. It could still be of use in general Ruby scripts though. Notations such as this often prove very powerful. And in fact the idea does move us in a possible workable direction. There&#39;s no reason a string can&#39;t be marked as negative as well. After all it&#39;s just a flag. In fact, if we move the core method @- to Object itself, then any object can be so indicated. The above line could then be written:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="n">files</span> <span class="o">=</span> <span class="o">[</span> <span class="s1">&#39;**/*&#39;</span><span class="p">,</span> <span class="o">-</span><span class="s1">&#39;Installedfiles&#39;</span> <span class="o">]</span>
</code></pre></div>
<p>Methods such as Dir.multiglob(*files) (another Facet) could use this extra bit of information to provide the desired results, equivalent to:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="n">files</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;**/*&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;InstalledFiles&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Of course, this still doesn&#39;t quite help us with the YAML configuration file, but with a little fudging we can get a useful format.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="ss">files</span><span class="p">:</span> <span class="o">[</span> <span class="s1">&#39;**/*&#39;</span><span class="p">,</span> <span class="s1">&#39;-InstalledFiles&#39;</span> <span class="o">]</span>
</code></pre></div>
<p>As for the append parameter that was mentioned as the beginning, we could just add a special notation for this as well, say, &#39;$&#39; to mean defaults.</p>

<p>Okay. So will I use this bit of trickery to reduce three parameters to one? Perhaps. While the result is wonderfully practical in usage, it&#39;s not necessarily so simple to implement. Either a filter would have to split the one entry into three parts when loading, or an untold number of methods would have to augmented to take the trick into consideration. The later I imagine would simply prove too extensive w/o pre-established support for the negation concept. The former might be reasonable however. I&#39;ll give it a try.</p>

<p>In any case it was in interesting thought experiment. Although perhaps you have a better way to represent this kind of information?</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2006-03-December" title="December 03, 2006">December 03, 2006</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2006/11/11/we-all-live-in-a-yellow-submarine/" rel="prefetch">We All Live In A Yellow Submarine</a></h1>
            <p><h1>We All Live in a Yellow Submarine</h1>

<p>Anyone having read my previous posts, here and on ruby-talk, knows I love to explore ideas. It doesn&#39;t matter if they are considered &quot;good&quot; or &quot;bad&quot;. Most cannot be judged without first exponding on them anyway. In fact, half the time I have no idea where an idea might lead until I sit down and blog it.</p>

<p>Tonight&#39;s idea comes by way of frustration with project organization, specifically module namespaces. A minor issue for small projects; large projects on the other hand... Well, consider my current problem. I have a class called Project. Now related to Project are a number of modularized tool sets. Each tool set can be used independently of the Project class, but typically will be used via it. So where do I locate the tool sets? My first instinct is to go ahead and put them in the class itself.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">module</span> <span class="nn">MyApp</span>
    <span class="k">class</span> <span class="nc">Project</span>
      <span class="k">module</span> <span class="nn">ToolSetA</span>
      <span class="k">module</span> <span class="nn">ToolSetB</span>
</code></pre></div>
<p>But I find this less the optimal. While it may be a small and unlikely matter, class is not a bonofide namespace --it is a class. And while it depends on these tool sets, the tool sets do not necessarily depend on it. As such we would never be able to include these tool sets in another namespace --such as the toplevel if it struck my or some users fancy. So we are left then to use some alternate organization.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">   <span class="k">class</span> <span class="nc">Project</span>
   <span class="k">module</span> <span class="nn">ProjectToolsets</span>
     <span class="k">module</span> <span class="nn">ToolSetA</span>
     <span class="k">module</span> <span class="nn">ToolSetB</span>
</code></pre></div>
<p>or as a compromise</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">   <span class="k">class</span> <span class="nc">Project</span>
     <span class="k">module</span> <span class="nn">Toolsets</span>
       <span class="k">module</span> <span class="nn">ToolSetA</span>
       <span class="k">module</span> <span class="nn">ToolSetB</span>
</code></pre></div>
<p>The downside here, of course, are the long-winded names. But a better solution eludes me, other than one possibility: the use of all capitals for pure namespace modules.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">   <span class="k">class</span> <span class="nc">Project</span>
   <span class="k">module</span> <span class="nn">PROJECT</span>
     <span class="k">module</span> <span class="nn">ToolSetA</span>
     <span class="k">module</span> <span class="nn">ToolSetB</span>
</code></pre></div>
<p>It&#39;s a bit strange in appearance but it works well. One quark however is that this new rule begs for my project&#39;s toplevel namepsace to be all caps too. Do I want to go there?</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">module</span> <span class="nn">MYAPP</span>
   <span class="k">class</span> <span class="nc">Project</span>
   <span class="k">module</span> <span class="nn">PROJECT</span>
     <span class="k">module</span> <span class="nn">ToolSetA</span>
     <span class="k">module</span> <span class="nn">ToolSetB</span>
</code></pre></div>
<p>I&#39;m not sure it&#39;s the solution I&#39;m after, but to its merit, it does draw a nice distinction between namespace modules and other modules and classes.</p>

<p>In the course of this consideration I began to wonder about the distinction between Class and Module. The difference is almost not-existent in reality. If you peer into the Ruby source code you will find that interoperability between them is purposefully prevented. After all Class is a subclass of Module. Yet they are made distinct for a good reason. They provide conceptually different ideas. A class represents an data archetype; a module represents a reusable component. In fact, one could easily argue that Module itself could use an additional distiction between Namespace and Mixin. Even so, I could not help but wonder if it might yet be possible to have a single Encapsulation, relegating the differences to the elements within them instead of the encapsulation types themselves. I imagined this:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">Something</span>
    <span class="k">def</span> <span class="nf">x</span>
    <span class="k">def</span> <span class="nf">y</span>
    <span class="n">mod_def</span> <span class="n">a</span>
    <span class="n">mod_def</span> <span class="n">x</span>
    <span class="k">class</span> <span class="nc">SomethingElse</span>
</code></pre></div>
<p>Instantiating via Something.new or subclassing would provide the instance methods x and y. Including however would provide the mod<em>def methods a and x instead along with adding SomethingElse to the including namespace. More refined means of controlling namespace become possible. For instance include</em>constants could limit inclusion to constants only; vice-verse with include<em>methods. Methods could be defined as both instance and module methods. And while we&#39;re at it, throw in a class</em>def as an alternative to def self.x.</p>

<p>It&#39;s interesting. I&#39;ve often thought about the idea of eliminating the distinction between Class and Module. This is the first time it&#39;s occurred to me that it could be done while retaining the utility of that distinction by passing responsibility down to the methods themselves.</p>

<p>I suppose now the question is, what are the downsides to this? That&#39;ll require further consideration, but one clear point is that methods are less cleanly divided. You could have module methods scattered about your class definitions, weaving in and out of your instance methods. I suspect we would make an effort to nicely organize them however. Besides it means having fewer modules to name --and I&#39;m all for anything that reduces the number of names I have to make-up.</p>

<p>It would be interesting to see how far one could go in implementing this in pure Ruby. Some details of Ruby will hold back a perfect implementation, but the essence of it is certainly possible. For starters, here&#39;s a neat trick for doing without the distinction between class and module.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">Module</span>
    <span class="k">def</span> <span class="nf">new</span>
      <span class="n">mod</span> <span class="o">=</span> <span class="nb">self</span>
      <span class="no">Class</span><span class="o">.</span><span class="n">new</span><span class="p">{</span> <span class="kp">include</span> <span class="n">mod</span> <span class="p">}</span><span class="o">.</span><span class="n">new</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>
<p>Have fun! Unfortunately I&#39;m not. I&#39;m still stuck on the forementioned namespace issue! Oh well. Back to the coding board...</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2006-11-November" title="November 11, 2006">November 11, 2006</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2006/11/10/separation-of-church-and-state/" rel="prefetch">Separation Of Church And State</a></h1>
            <p><h1>Separation of Church and State</h1>

<p>Have you ever had a class so choke full of interrelated data and function members that had trouble avoiding name clashes between the two. Of course it&#39;s a rare problem when you&#39;re in full control of the members, but when you&#39;re designing extensible classes, it become a major issue and you have to resort to some less-than-lovely work around.</p>

<p>Let me give you a simple scenario.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">Package</span>
    <span class="c1"># Release date</span>
    <span class="c1">#</span>
    <span class="kp">attr</span> <span class="ss">:release</span>

    <span class="c1"># Release the package.</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="nf">release</span>
       <span class="nb">puts</span> <span class="s2">&quot;Telling the world on </span><span class="si">#{</span><span class="vi">@release</span><span class="si">}</span><span class="s2">...&quot;</span>
       <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>
<p>The issue here is clear. On one hand, we want to use release as a noun to represent the date of release. On the other, we want to use it as a verb for releasing the package to the world. Of course, under completely isolated circumstances we could just change one of the names and deal. But when we are working on the basis of extensibility, where these and additional data or functional members may be added readily, say via a plug-in system, then a solution is not as simple.</p>

<p>So what can we do? The bottom line is that in some way or another the two member types must be distinguished from one another.</p>

<p>One could transform one set of the members with a slightly different name via some uniform convention. For instance, all data members could start with &quot;my<em>&quot;, so release as a date would be my</em>release. Ruby actually makes this it a bit nicer in that we can use &#39;?&#39; or &#39;!&#39; prepended to method names. A fair solution might then be:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="k">def</span> <span class="nf">release?</span>
      <span class="vi">@release</span>
    <span class="k">end</span>
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="k">def</span> <span class="nf">release!</span>
      <span class="nb">puts</span> <span class="s2">&quot;Telling the world on </span><span class="si">#{</span><span class="n">release?</span><span class="si">}</span><span class="s2">...&quot;</span>
      <span class="c1">#...</span>
    <span class="k">end</span>
</code></pre></div>
<p>It&#39;s not a perfect solution however, especially as a matter of convention. It goes against the grian. &#39;?&#39; typically indicates a true/false query. And &#39;!&#39; indicates in place or caution. Consider how others will &quot;smell&quot; your code when they see a question mark for every reference to a data member.</p>

<p>The other more traditional solution is to use delegation. In this case we make a subclass for either or both of the member types. For instance:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">Package</span>

    <span class="k">class</span> <span class="nc">Data</span>
      <span class="kp">attr</span> <span class="ss">:release</span>
    <span class="k">end</span>

    <span class="kp">attr</span> <span class="ss">:data</span>

    <span class="k">def</span> <span class="nf">initialize</span>
      <span class="vi">@data</span> <span class="o">=</span> <span class="no">Data</span><span class="o">.</span><span class="n">new</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">release</span>
      <span class="nb">puts</span> <span class="s2">&quot;Telling to the world on </span><span class="si">#{</span><span class="n">data</span><span class="o">.</span><span class="n">release</span><span class="si">}</span><span class="s2">...&quot;</span>
      <span class="c1">#...</span>
    <span class="k">end</span>

  <span class="k">end</span>
</code></pre></div>
<p>Albeit a bit longer. It works very well. Delegation is a powerful tool. One could even emulate the former solution via method_missing, trapping method calls that end in &#39;?&#39; and rerouting them to @data. Another advantage is that we can readily pass around the data independent of the function members. On the flip side however, we are regulated to this special data.member interface. and likewise any reverse access by the data members to the functional members, if ever needed, would require us to also pass a reference to the Package instance into the Data instance.</p>

<p>In considering all this of course, it becomes apparent that Ruby already has a means of distinguishing data members from functional members via instance variables. Clearly @release references the date. But Ruby does not give us the power to treat &quot;instance members&quot; publicly or programmaticly. We can&#39;t, for instance, use project.@release to access the release date. Nor can we wrap data members in order to massage their data, say:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">def</span> <span class="vi">@release</span>
    <span class="k">super</span> <span class="o">||</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
  <span class="k">end</span>
  <span class="kp">public</span> <span class="ss">:@release</span>
</code></pre></div>
<p>I&#39;m sure many readers will take such notion for simply god awful. But I think careful consideration at least warrants the fair question. &quot;Is a distinct separation between data and functional members useful?&quot; The mere existence of instance variables indicates that the distinction is in fact useful. In contrast, data members could have been made indistinguishable from functional members, or local variable persistence could be used in their stay. So if the distinction is useful, why hide public access to data members behind functional members acting as mini-delegates?</p>

<p>To be a bit more pragmatic, how would a solution to our example pane out if data members were in fact accessible? Interestingly it could look exactly like the original example. Public access to the release date however would simply come via project.@release or preferably even project@release. And there would be no need for any name (mis)conventions or special-interface delegation.</p>

<p>Of course let&#39;s be honest here. &#39;@&#39; itself is the Special Delegate of State to the Ruby &quot;Church&quot;. Too bad he&#39;s only allowed to preach to the choir.</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2006-10-November" title="November 10, 2006">November 10, 2006</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2006/10/21/frustration-with-object-orientation/" rel="prefetch">Frustration With Object Orientation</a></h1>
            <p><h1>Frustration with Object-Orientation</h1>

<p>I&#39;ve spent more weeks than I care to count going around in circles.</p>

<p>You see the problem is I have &quot;tools&quot; that are in essence methods. But the are generally complicated enough to warrent using state and being broken into many smaller supporting methods. That&#39;s fine and dandy until I try to tie a bunch of these tools together under the same class. Name clashes become a huge problem, to the point that it is simply unworkable. The need for local instance variables and methods becomes a big deal. The only way to currently achieve that is to use lambdas and define_method. Not ideal, and RDocs become all but useless. To avoid this I tried going in the opposite direction, defining the tools as their own classes instead. This works great until the tool needs to take part in a more complex structure. For example I have hosting service classes that provide releasing and publishing tools. Well, if &#39;release&#39; and &#39;publish&#39; are classes rather then methods how are they going to call the hosting service&#39;s login method? I&#39;m forced into using delegation, passing them the instance of the Host class to which they are supposed to belong. At that point the result is worse than the original problem. So in either case I&#39;m finding it neccessary to to write and maintain hacky code. And I&#39;m just fet up with it.</p>

<p>Over the last five years I&#39;ve spent a great deal of time working with Ruby and learning Object-Oriented programming practices it&#39;s associated design patterns. It all seemed very logical at first. But as time wore on I found myself again and again feeling hemmed in. I assumed it was just that I did not understand it all well enough yet to use it well so I kept at it. Certainly my skills improved, but in retorsect it wasn&#39;t some great understanding as much it was &quot;don&#39;t do that&quot;. And even so, I still ran into these walls.</p>

<p>And this is waht I think it is. OOP requires you to first design the encapsulating structure of your project. And your whole edifice depends on that supporting design. If for some reason any bit of that should change, you may well find yourself tearing down whole walls in order to build them up again. And this can happen over and over if you weren&#39;t sure of the original edifice from the start. For a large project that&#39;s a lot to ask --knowing how the whole outward structure should be before you even know the materials involved.</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2006-21-October" title="October 21, 2006">October 21, 2006</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2006/10/02/i-see-you/" rel="prefetch">I See You</a></h1>
            <p><h1>I See You</h1>

<p><img src="/assets/images/iseeyou.jpg" alt="I See You Picture"></p>

<p>You have to <a href="http://tenderlovemaking.com/2006/09/28/new-ruby-betabrite-002/">check this out</a>. Okay. I know. I know. It&#39;s been blogged by others many times now. In fact, you can check out these other blog posts too: Why<em>the</em>lucky_stiff has it on <a href="http://redhanded.hobix.com/inspect/hackASignOnSomeoneElseSWoodFloors.html#comments">Redhanded</a>, and <a href="http://www.eachmapinject.com/2006/9/29/betabrite">J&#39;ey</a> put out the word as well. But it&#39;s just so damn cool, I just had to blog it too!</p>

<p>Go ahead. Try it at home:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="nb">require</span> <span class="s1">&#39;drb&#39;</span>

  <span class="k">def</span> <span class="nf">brite_shot</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;druby://eviladmins.org:9000&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="no">DRbObject</span><span class="o">.</span><span class="n">new_with_uri</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;out.jpg&quot;</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">a</span><span class="o">|</span>
      <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">obj</span><span class="o">.</span><span class="n">write_simple</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">brite_shot</span><span class="p">(</span><span class="s2">&quot;I SEE YOU!&quot;</span><span class="p">)</span>
</code></pre></div>
<p>(And if a still picture isn&#39;t enough for you. How about an <a href="http://pastie.caboo.se/15646">animation</a>.)</p>

<p>And so, a REAL picture is made for me by remote many thousands of miles away. How far I wonder? Well, with a GeoIP lookup and Google Maps, I found out <a href="http://maps.google.com/maps?f=q&amp;hl=en&amp;q=47.610%C2%B0N,+122.304%C2%B0W&amp;ie=UTF8&amp;z=17&amp;ll=47.61,-122.304&amp;spn=0.004231,0.012757&amp;t=h&amp;om=1">where this picture was made</a>. The world really is getting smaller.</p>

<p>I See You!</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2006-02-October" title="October 02, 2006">October 02, 2006</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2006/09/21/i-no-longer-believe-in-methods/" rel="prefetch">I No Longer Believe In Methods</a></h1>
            <p><h1>I No Longer Believe in Methods</h1>

<p>Yes, that&#39;s right. I no longer believe in methods. Why? Becuase this is OOP and if the methods aren&#39;t honest to goodness objects from the start, without exception, then they are not really methods. They&#39;re just glorified functions.</p>

<p>Let me show you what I mean. I have a Project class in which is defined a set of tools that can manipulate it. Clearly the proper implementation abstraction for these tools is the method.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="no">Class</span> <span class="no">Project</span>
    <span class="k">def</span> <span class="nf">announce</span>
      <span class="nb">puts</span> <span class="s2">&quot;This is my new project!&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>
<p>But these tools must be distinguishable from other supporting methods. Moreover additional information may be associated with these tools, like help information or valid states of the Project for the tool to be useful. How do we encode this information with Ruby? Since methods aren&#39;t first class objects, we are forced to return to functional programming. In which case, it is best to define some sort of DSL.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">module</span> <span class="nn">ProjectDSL</span>
    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span> <span class="nb">name</span><span class="p">,</span> <span class="n">text</span> <span class="p">)</span>
      <span class="vi">@help</span> <span class="o">||=</span> <span class="p">{}</span>
      <span class="vi">@help</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span> <span class="o">=</span> <span class="n">text</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">valid</span><span class="p">(</span> <span class="nb">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="nb">test</span> <span class="p">)</span>
      <span class="vi">@valid</span> <span class="o">||=</span> <span class="p">{}</span>
      <span class="vi">@valid</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span> <span class="o">=</span> <span class="nb">test</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="no">Class</span> <span class="no">Project</span>
    <span class="kp">extend</span> <span class="no">ProjectDSL</span>

    <span class="k">def</span> <span class="nf">announce</span>
      <span class="nb">puts</span> <span class="s2">&quot;This is my new project!&quot;</span>
    <span class="k">end</span>

    <span class="n">help</span> <span class="ss">:announce</span><span class="p">,</span> <span class="s2">&quot;Announces your project to the world!&quot;</span>
    <span class="n">valid</span> <span class="ss">:announce</span> <span class="p">{</span> <span class="vi">@version</span> <span class="o">&gt;</span> <span class="s2">&quot;0.0.0&quot;</span> <span class="p">}</span>
  <span class="k">end</span>
</code></pre></div>
<p>Now this kind of thing has come up enough in large projects, such as Nitro, that a general means of annotation proved to be most effective.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="nb">require</span> <span class="s1">&#39;facet/annotation&#39;</span>

  <span class="no">Class</span> <span class="no">Project</span>
    <span class="k">def</span> <span class="nf">announce</span>
      <span class="nb">puts</span> <span class="s2">&quot;This is my new project!&quot;</span>
    <span class="k">end</span>

    <span class="n">ann</span> <span class="ss">:announce</span><span class="p">,</span> <span class="ss">:help</span> <span class="o">=&gt;</span> <span class="s2">&quot;Announces your project to the world!&quot;</span><span class="p">,</span>
                   <span class="ss">:valid</span> <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="vi">@version</span> <span class="o">&gt;</span> <span class="s2">&quot;0.0.0&quot;</span> <span class="p">}</span>
  <span class="k">end</span>
</code></pre></div>
<p>Annotations works very well, and if you find yourself in need of this kind of &quot;method metadata&quot; it is an excellent approach.</p>

<p>But I&#39;ve worked with all this long enough now to be able to have a wide perspective on it and it&#39;s become very clear to me that the whole &quot;special needs&quot; arises out of the fact that Ruby is still just a functional language in this respect, and not a full OOPL. (And please no objections that method() and instance_method() make it otherwise, these do not provide a persitant object, but return a new object every time they are invoked.) So what might the above look like if it were not so? There would of course be more than one way to go about it, but imagine this:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">Tool</span> <span class="o">&lt;</span> <span class="no">Method</span>
    <span class="kp">attr_accessor</span> <span class="ss">:help</span>

    <span class="k">def</span> <span class="nf">valid</span><span class="p">(</span> <span class="o">&amp;</span><span class="nb">test</span> <span class="p">)</span>
      <span class="vi">@valid</span> <span class="o">=</span> <span class="nb">test</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="no">Class</span> <span class="no">Project</span>
    <span class="k">def</span> <span class="nf">announce</span> <span class="o">=&gt;</span> <span class="no">Tool</span>
      <span class="nb">puts</span> <span class="s2">&quot;This is my new project!&quot;</span>
    <span class="k">end</span>

    <span class="n">announce</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Announces your project to the world!&quot;</span>

    <span class="n">announce</span><span class="o">.</span><span class="n">valid</span> <span class="p">{</span> <span class="vi">@version</span> <span class="o">&gt;</span> <span class="s2">&quot;0.0.0&quot;</span> <span class="p">}</span>
  <span class="k">end</span>
</code></pre></div>
<p>I&#39;m taking some liberties with the syntax here for clarity. But in anycase it certainly paints a provocative idea. And I would argue that it paints the approprite OOP idea too.</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2006-21-September" title="September 21, 2006">September 21, 2006</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h1 class="title"><a href="/2006/08/26/the-persnickety-order-of-self-serving-modules/" rel="prefetch">The Persnickety Order Of Self Serving Modules</a></h1>
            <p><h1>The Persnickety Order of Self-Serving Modules</h1>

<p>This one caught me off guard.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  irb(main):001:0&gt; module M
  orb(main):002:1&gt;   def x; &quot;x&quot;; end
  orb(main):003:1&gt; end
  =&gt; nil
  orb(main):005:0&gt; module Q
  orb(main):006:1&gt;   extend self
  orb(main):007:1&gt;   include M
  orb(main):008:1&gt; end
  =&gt; Q
  orb(main):009:0&gt; Q.x
  NoMethodError: undefined method `x&#39; for Q:Module
          from (orb):9
          from :0
</code></pre></div>
<p>Why isn&#39;t the included #x coming along for the ride in the self extension of Q? This kind of dyanmicism is vital when dynamically loading behaviors. And so I suspect it must do with the dread <a href="http://groups.google.com/group/comp.lang.ruby/msg/70509b289f0ea999">Dynamic Module Inclusion Problem</a>? And it would appear that I am right:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">  orb(main):012:0&gt; module M
  orb(main):013:1&gt;   def x; &quot;x&quot;; end
  orb(main):014:1&gt; end
  =&gt; nil
  orb(main):015:0&gt; module Q
  orb(main):016:1&gt;   include M
  orb(main):017:1&gt;   extend self
  orb(main):018:1&gt; end
  =&gt; Q
  orb(main):019:0&gt; Q.x
  =&gt; &quot;x&quot;
</code></pre></div>
<p>Yes, another of the edge cases. But the preponderance weighs heavy on the Coding Spirit. The Dynamic Module Inclusion Problem is getting old.</p>
</p>
            <div class="meta">
                Written By <address>trans</a> &mdash;
                <time pubdate datetime="2006-26-August" title="August 26, 2006">August 26, 2006</time>
            </div>
        </div>
        <hr>
    </section>
    
    
    <section class="pagination" style="text-align:center">
      
        
        <a href="/page6" class="btn btn-outline"> Newer</a>
        
      
      
        <a href="/page8" class="btn btn-outline">Older </a>
      
    </section>
</article>


<footer class="site-footer">
    <div class="container">
        &copy; 2014 
        
        <nav>
            <a href="http://transcode.github.com">TRANS</a> &middot;
            <a href="/">Blog</a> &middot;
            <a href="http://github.com/trans">Product</a> &middot; 
            <a href="/About/">About</a>
        </nav>
        
        <nav class="social">
            
            <a href="https://twitter.com/transgigamic" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
                
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
        <p>Incorporated theme by <a href="https://sendtoinc.com">Inc</a></p>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>


</body>
</html>
