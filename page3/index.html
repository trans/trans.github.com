<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRANSCODE &mdash; Trans Technology and Programming Blog</title>
    <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/logo.png"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="TRANSCODE" />
    <meta name="title" content="TRANSCODE">
    <link rel="canonical" href="http://trans.github.com/page3/">
     
           
    <meta property="og:title" content="TRANSCODE"/>
    <meta property="og:url" content="http://trans.github.com/page3/"/>
    
    
    <meta property="og:site_name" content="TRANSCODE">
</head>
<body>
    
<section class="site-nav">
    <header>
        <nav id="navigation">
            <a class="brand" href="/">
                <img src="/images/logo.png" alt="Inc">
            </a>
            <a href="/" class="home">Blog</a>
            <a href="http://incorporated.sendtoinc.com/">Product</a>
            <a href="https://tabcomputing.com/about/">About</a>
        </nav>
        <nav class="tagline">
            <span>Get a modern blog for your company</span>
            <a href="http://incorporated.sendtoinc.com/" class="btn btn-outline">Learn More</a>
        </nav>
    </header>
</section>

<div class="blog-cover" style="background-image:url(/images/blog-cover.jpg);">
    
    <section>
        <div class="container">
            <h1>TRANSCODE</h1>
            <h3>Trans Technology and Programming Blog</h3>
        
            
            
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss"></i>
            </a>
        </div>
    </section>
</div>

<article class="container">

  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/06/13/instance-variables-as-syntax-sugar/" rel="prefetch">Instance Variables As Syntax Sugar</a></h2>
            <p><h1>Instance Variables as Syntax Sugar</h1>

<p>What are instance variables? If we think of them as a single unit we note that they represent an object <em>state</em>, which as a data structure is really nothing more than a <em>hash</em>. Indeed, it is quite feasible to forgo the use of instance variables altogether save one, to serve as the object&#39;s state.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">class</span> <span class="nc">Example</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">attr_reader</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="n">define_method</span><span class="p">(</span><span class="nb">name</span><span class="p">){</span> <span class="vi">@state</span><span class="o">[</span><span class="nb">name</span><span class="o">.</span><span class="n">to_sym</span><span class="o">]</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">attr_writer</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="n">define_method</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">=&quot;</span><span class="p">){</span> <span class="o">|</span><span class="n">v</span><span class="o">|</span> <span class="vi">@state</span><span class="o">[</span><span class="nb">name</span><span class="o">.</span><span class="n">to_sym</span><span class="o">]</span> <span class="o">=</span> <span class="n">v</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">attr_accessor</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="kp">attr_reader</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="kp">attr_writer</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">initialize</span>
      <span class="vi">@state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>
<p>So if instance variables are essentially a hash, why is it that we cannot work with them as such? In other words, why not have <code>@</code> just represent a syntax sugar for a special hash (even if it&#39;s not a standard Ruby Hash instance under the hood, it can behave as if it were). With such a change, handling instance variables immediately become much easier and intuitive since we can apply all our knowledge if hashes.</p>

<p>Some neat capabilities immediately become apparent. Looking up an instance variable give a variable name can be done with:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="err">@</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span>
</code></pre></div>
<p>Assigning an instance variable likewise can be done with:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="err">@</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div>
<p>No longer would the long-winded <code>instance_variable_get</code> and <code>instance_variable_set</code> be needed.</p>

<p>Let&#39;s take a more complex example. Have you ever wanted to reproduce the name and values of an object instance variable. It&#39;s not uncommon really. Any type of object serialization is going to need such a routine -- YAML, Marshal, etc. To do this presently requires some verbose code:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="nb">hash</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="nb">instance_variables</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">var</span><span class="o">|</span>
    <span class="nb">hash</span><span class="o">[</span><span class="n">var</span><span class="o">]</span> <span class="o">=</span> <span class="nb">instance_variable_get</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="nb">hash</span>
</code></pre></div>
<p>But with <code>@</code> sugar we can simply use:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="nb">hash</span> <span class="o">=</span> <span class="err">@</span><span class="o">.</span><span class="n">to_h</span>
</code></pre></div>
<p>Or if we just want to iterate over them:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="err">@</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span>
    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="k">end</span>
</code></pre></div>
<p>Since we have #each, then all Enumerable methods would be at our disposal.</p>

<p>For a public interface <code>instance_variables</code> could reference the internal <code>@</code> instead of just the list of instance variable names. We could deprecate <code>#instance_variable_get</code> and <code>#instance_variable_set</code> altogether.</p>

<p>By recognizing the nature of instance variables and applying the preexisting functionality of Hash, we gain much greater capability while using fewer brain cells to do it. And that&#39;s always a win.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-13-June" title="June 13, 2012">June 13, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/05/23/real-metal/" rel="prefetch">Real Metal</a></h2>
            <p><h1>Real Metal</h1>

<p>One of the most regarded capabilities of Ruby, in contrast to many other programming languages, is its powerful meta-programming chops. While not every aspect of the language is meta-programmable, the vast majority of Ruby is. But despite its prowess, there is a serious weaknesses in its design: <em>The functions on which meta-coders depend have no guarantee</em>. </p>

<p>Consider the most basic reflection method of determining the class of an object, fundamental to almost any meta-programming (and some not-so-meta0programming). We can write a class that completely subverts the ability to determine an object&#39;s class.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Foo</span>
  <span class="k">def</span> <span class="nf">class</span>
    <span class="s2">&quot;I Confuse You!&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Because <code>Foo</code> has overridden the <code>#class</code> method, there is no way to determine the class of an instance of Foo. Any code dependent on the <code>#class</code> method &quot;contract&quot; is going to choke.</p>

<p>We can be thankful that most programs will, by simple happenstance, never tread on any of these important methods. In the few cases where they might, most Ruby coders are aware enough to steer clear. Yet there are other cases not so easily handled. Consider Ruby&#39;s relatively new BasicObject class. It has the minimal number of methods necessary to function as an object in Ruby. This is excellent for the construction of open classes akin to OpenStruct, but consequently there is no way to find out what methods are defined on such an object because there is no such methods as <code>#methods</code> or <code>#instance_methods</code>. Moreover, BasicObject is still not completely empty. It still defines <code>__id__</code>, <code>__send__</code>, <code>instance_eval</code>, <code>instance_exec</code> and a few others, without which an object simply wouldn&#39;t be usable.</p>

<p>So basically Ruby has settled on a &quot;close enough&quot; approach to handling reflection and meta-programming. But why should we be willing to settle for any risk at all? The reasoning I have most often heard is an OOPL ideological principle arguing that no method should stand outside the realm of the inheritance chain, and thus all methods are necessarily subject to overrides. But I am not convinced for the simple reason that meta-programming is by it&#39;s nature &quot;<em>meta</em>&quot;.</p>

<p>As an experiment. I developed a small library to take the risk out of meta-coding. The library basically works as follows:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="vg">$meta</span> <span class="o">=</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">obj</span><span class="o">|</span>
    <span class="no">Functor</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">|</span>
      <span class="no">Kernel</span><span class="o">.</span><span class="n">instance_method</span><span class="p">(</span><span class="n">op</span><span class="p">)</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="vg">$meta</span><span class="o">[</span><span class="s2">&quot;some string&quot;</span><span class="o">].</span><span class="n">class</span> <span class="c1">#=&gt; String</span>
</code></pre></div>
<p>This meta-function works fairly well in most cases. However it has three shortcomings that make it essentially impractical for production use: 1) It lacks module methods; 2) It is terribly inefficient; and 3) It doesn&#39;t work for BasicObject instances.</p>

<p>While my little library might be improved upon, ideally Ruby would provide a set of &quot;meta-functions&quot; that cannot be overridden in-class. These methods could all be defined in a special module, but used via alternate notation so as not to conflict with ordinary methods. To that end I suggest using <code>$</code> on regular objects:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"> <span class="n">obj</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>
 <span class="n">obj</span><span class="vg">$class</span> <span class="c1">#=&gt; String</span>
</code></pre></div>
<p>Numerous other methods would be made available through this, in general all public Kernel methods are candidates for inclusion, and some Module methods usable just for classes and modules, such as <code>#instance_methods</code>.</p>

<p>The robustness this would bring to Ruby&#39;s meta-programming would be a great boon and should not be understated. When a single line of code can so easily cause every object in a program to fail, it&#39;s not unreasonable to prefer some guarantees. Moreover, it makes the meta-programmer&#39;s task much easier --he knows exactly what methods on which to depend.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-23-May" title="May 23, 2012">May 23, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/05/11/the-problem-with-programming/" rel="prefetch">The Problem With Programming</a></h2>
            <p><h1>[DRAFT] THE PROBLEM WITH PROGRAMMING</h1>

<p>Programming is the art of tying thought to syllogism. The programmer must take an often nebulous idea and encode it into a symbolic logical language. By it&#39;s very nature then, there is gap that must be breached between the thoughts of the programmer (harder still the thoughts of his client) and the 
construction of their autonomic model. This then is the problem of programming: finding ways 
to shrink that gap.</p>

<p>At it&#39;s root a program is a series of logical ones and zeros, arranged just-so to create what can best be
analogized to the non-programmer as the falling of dominoes.</p>

<p>...</p>

<p>It should be clear that to span the divide we must build systems that allow us to most readily convey our ideas about a &quot;thing&quot; and interconnect them in dynamic relationships. For instance, if I were to speak of a &quot;ball&quot;, a whole range of things would occur to the average person. Most everyone has had many experiences
with a thing called &quot;ball&quot;. They would certainly know that they often bounce, though some can be quite hard;
they come in all sizes, but they are almost always spherical. These facts might seem trivial to you
and I, but to a computer, they are as far from us as quasars. </p>

<p>If we ever hope to be able to instruct computers in a fashion akin to our speech, and expect that the system will naturally arrange the ideas of which we speak, then we are going to have to start with
encoding the nature of things we know. We do this presently with knowledge on the human level, via dictionaries, encyclopedia and the like. But we are speaking of computers and to convey things
to a computer they must be extensively deconstructed.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">ball:
  definition:
    source: Websters
    number: 1
    description: a round or roundish body or mass
  shape:
    terms: [round, sphere]
    volume: 4/3*PI*r^3
    surface: 4*PI*r^2
  types: [&#39;bowling&#39;, &#39;football&#39;, &#39;soccer&#39;, &#39;baseball&#39;]
</code></pre></div>
<p>Our ball is very simplistic and far from complete at this point, but the nascent idea is conveyed. Yet to actually do anything with these constructs, it will be important to provide functional information in addition to the descriptive. We get a hint of this already with the surface and volume definitions given.
More complex functions could be provided, such as physical formulae for bouncing.</p>

<p>I do not believe we must be overly concerned about the exact hierarchical structure nor use of terms these constructs take. A general pattern will arise that developers will adopt as conventions. Such system of conventions tends to be reliable enough for such matters.</p>

<p>Now, taking this notion a step further, let us propose a universally available resource for creating and editing these semantic constructions. From which, they could be utilized as a general resource by all developers.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-11-May" title="May 11, 2012">May 11, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/05/09/proper-construction-of-a-class/" rel="prefetch">Proper Construction Of A Class</a></h2>
            <p><h1>The Proper Construction of a Class [DRAFT]</h1>

<p>A general principle of good programming is SOC, Separation of Concerns. SOC
is a general rule that helps us break code up into logical groups around a single concern.
More often the principle is applied at a systems level via separate packages, tools, libraries
or components. But the principle is equally applicable to a class itself.</p>

<p>Ruby&#39;s own Hash class provides a good example to demonstrate how this principle can be applied.
When we consider the concerns of the Hash class we must think of the methods that make it a Hash.
The most fundamental distinction between methods for any class is the fundamental methods versus
the derivative methods. In other words, derivative methods depend on the fundamental methods, and
have no direct contact to the under-lying state of the object except via the fundamental methods.
This division not only gives us guidance on how to organize our classes, but also how to best
write methods for our classes --by attempting to use the minimum number of necessary fundamental
methods.</p>

<p>For Ruby&#39;s Hash, the fundamental methods are more or less <code>#fetch</code>, <code>#store</code>, <code>#delete</code>, <code>#keys</code>, <code>#key?</code> and perhaps <code>#size</code> in addition to any necessary equality methods, such as <code>#==</code>. There are, of course, Ruby system methods also, such as <code>#hash</code> and <code>#inspect</code>, but we can take them for granted. All other methods, such as <code>#update</code> and <code>#each</code> can be built from these methods.</p>

<p>Of course Ruby&#39;s Hash isn&#39;t actually implemented in this way. But is <strong>should</strong> be! This kind of design I call &quot;CRUDifed&quot;, because the fundamental methods of any class are generally the ones that represent create, read, update and delete functions.</p>

<p>Who would have ever though this was good advice? &quot;Make your models CRUDy!&quot; :-)</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-09-May" title="May 09, 2012">May 09, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/04/14/all-quiet-on-the-google-front/" rel="prefetch">All Quiet On The Google Front</a></h2>
            <p><h1>All Quiet on the Google Front</h1>

<p>As I write this I am am on hold to Google main line. I&#39;ve been on hold for nearly an hour. <i>&quot;... Your call is important to us and we appreciate your patience. Please stay on the line and our next available representative will be with you shortly...&quot;</i> </p>

<p>How ironic that the help page for Google Groups says, &quot;The new Google Groups is faster, more powerful, and just plain cool.&quot; A few weeks ago, I noticed that Google de-listed Google Groups from the iGoogle menus and that all groups that are archive mirrors of external lists stopped working. As a maintainer of handful of such lists, I&#39;ve been investigating the issue for a while, but the only information I have been able to garner is by word of mouth via Matz, the creator of Ruby, &quot;friend of mine found out that recently google group started ignoring mails with List-ID header field.&quot; How <em>powerful cool</em> is that?</p>

<p>When I finish this article I will hang-up the phone and proceed to deprecate a number of Google Groups that I manage, namely, <code>ruby-talk-google</code>, <code>yaml-core</code>, <code>libxml-devel</code> and <code>rubygems-developers</code>. All of which are mirrored lists. At first I will just put up a deprecation notice. In a few weeks I will remove the lists altogether. But I won&#39;t stop there. The fact that these lists have all stopped working with the advent of Google&#39;s recent push to the &quot;new Google Groups&quot; and that Google has not made a single announcement about this MAJOR feature deprecation is inexcusable. I have had my fair share of issues with Google in the past. The inability to sort my mail by sender has always been a pain in my gmail-side. And everyone knows Google&#39;s customer support is notoriously non-existent. But I have always stayed with them because their web applications are generally excellent and really outstrip the competition in most respects, not the least of which is online availability, which makes them extremely convenient. Until recently I also felt that Google followed their company motto of &quot;Do No Evil&quot; fairly well. And yet it seems Google, like so many giants of the past, has begun to topple and loose sight of its foundations.</p>

<p>So, I plan to find a new home for my other non-mirrored lists as well. And sometime after that I will begin to look into new email options. I am hopeful, by the end of the year I will be Google free --for the first time since I first &quot;googled&quot; the Internet way back in 1999.</p>

<p>Speaking of time. I&#39;ve now been on hold for two-hours. I think it&#39;s time the throw in the old towel. I have a lot of &quot;Googleblechs!&quot; to clean up.</p>

<p><strong>[UPDATE]</strong> A few days after I wrote this, Google <em>mysteriously</em> fixed the issue, and now all mailing-lists are back online. I graciously concede that they have saved themselves from my abandonment, but <em>only</em> for the fact that there appear to be no comparable alternatives.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-14-April" title="April 14, 2012">April 14, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/04/13/peanut-butter-and-chocolate-handlebars/" rel="prefetch">Peanut Butter And Chocolate Handlebars</a></h2>
            <p><h1>Peanut Butter and Chocolate Handlebars</h1>

<p>This week I&#39;ve been working on the <a href="http://github.com/rubyworks/shomen">Shomen</a> documentation project. In particular I&#39;ve been converting the templates of my three web-based documentation viewers to compiled templates in order to boost rendering speed. Originally these viewers were using <a href="http://aefxx.com/jquery-plugins/jqote2/">jqote2</a> in one case (<a href="http://github.com/rubyworks/hypervisor">hypervisor</a>) and <a href="https://github.com/jquery/jquery-tmpl">jquery-tmpl</a> in the other two cases (<a href="http://github.com/rubyworks/rebecca">rebecca</a> and <a href="http://github.com/rubyworks/rubyfaux">rubyfaux</a>). While ascertaining what compilation solution to use, I tried the <a href="https://github.com/wookiehangover/jquery-tmpl-jst">jquery-tmpl-jst</a> for the later two, but immediately ran into fundamental errors. (Sorry, I don&#39;t recollect exactly what the errors were now). They were problematic enough to send me looking else where, and ultimately I decided on <a href="http://handlebarsjs.com/">Handlebars.js</a>.</p>

<p>Handlebars is great... mostly. Handlebars a variant of <a href="http://mustache.github.com/">Mustache</a> and is billed like Mustache as &quot;logic-less&quot; templates. But, whereas Mustache is <em>pure</em> about this ideal, Handlebars backs off a bit and at least allows some computation to take place via helpers. Unfortunately, from my experience I have found the ideal of &quot;logic-less&quot; templates to be largely misplaced, and not even Handlebars goes far enough to rectify the situation. What one ends up doing is just moving the &quot;logic&quot; to a separate file where it mostly consists of bits of trivial code and where it is more difficult to maintain because it is separated from the specific bit of markup it supports.</p>

<p>Take this example. It&#39;s the last bit of jqeury-tmpl I needed to convert to Handlebars for rubyfaux.</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html">  ${divy  = Rubyfaux.divy_methods(methods),&#39;&#39;}
  ${scope = [&#39;class&#39;,&#39;instance&#39;],&#39;&#39;}
  ${sight = [&#39;public&#39;,&#39;protected&#39;,&#39;private&#39;],&#39;&#39;}




        <span class="nt">&lt;h3&gt;</span>${v.capitalize()} ${s.capitalize()} METHODS<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;reference-list&quot;</span><span class="nt">&gt;</span>



        <span class="nt">&lt;/ul&gt;</span>
</code></pre></div>
<p>How does one translate this to Handlbars.js? It isn&#39;t a straight forward process. Handlebars doesn&#39;t allow the embedded assignments. So right off we see that <code>scope</code> and <code>sight</code> must be extracted. Secondly, the fact that some of the template is only shown if the combination of <code>scope</code> and <code>sight</code> has any entries, means this can&#39;t be rendered via a single Handlebars block helper. It has to be broken up so we can use a helper to render only if there are entries for each combination. But then it becomes difficult, if not impossible, to loop over <code>scope</code> and <code>sight</code> to keep our code DRY. Instead we end up with something like:</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html">    <span class="nt">&lt;h3&gt;</span>PUBLIC CLASS METHODS<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;reference-list&quot;</span><span class="nt">&gt;</span>







  ... ditto for each combination of scope and sight ...
</code></pre></div>
<p>Thank goodness there are only six combinations!</p>

<p>Of course, there is a way around this explosion in code. We can use a single block helper, but only if we render the <code>h3</code> and <code>ul</code> tags via the block helper too.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">Handlebars</span><span class="p">.</span><span class="nx">registerHelper</span><span class="p">(</span><span class="s1">&#39;methods_categorized&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">meths</span> <span class="o">=</span> <span class="nx">Rubyfaux</span><span class="p">.</span><span class="nx">divy_methods</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">methods</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">scope</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">,</span><span class="s1">&#39;instance&#39;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">sight</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;public&#39;</span><span class="p">,</span><span class="s1">&#39;protected&#39;</span><span class="p">,</span><span class="s1">&#39;private&#39;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">methods</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">scope</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">sight</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">combination</span> <span class="o">=</span> <span class="nx">meths</span><span class="p">[</span><span class="nx">scope</span><span class="p">[</span><span class="nx">i</span><span class="p">]][</span><span class="nx">sight</span><span class="p">[</span><span class="nx">j</span><span class="p">]];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">combination</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s2">&quot;&lt;h3&gt;&quot;</span> <span class="o">+</span> <span class="nx">scope</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">sight</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">capitalize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; METHODS&lt;/h3&gt;\n&quot;</span><span class="p">;</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s1">&#39;&lt;ul class=&quot;reference-list&quot;&gt;&#39;</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">k</span> <span class="k">in</span> <span class="nx">combination</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="nx">block</span><span class="p">(</span><span class="nx">meths</span><span class="p">);</span>
          <span class="p">};</span>
          <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span> <span class="o">+</span> <span class="s2">&quot;\n&lt;/ul&gt;&quot;</span><span class="p">;</span>
        <span class="p">};</span>
      <span class="p">};</span>
    <span class="p">};</span>    
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>
<p>Then our Handlebars template becomes the very simple:</p>
<div class="highlight"><pre><code class="html language-html" data-lang="html">
</code></pre></div>
<p>But what on earth have we done!? Pursuing the ideal of keeping our views cleansed of logic, and DRY, we&#39;ve ended up putting our view in our logic! You would think this is an obvious &quot;no no&quot; too, but look at some of the examples on <a href="http://handlebarsjs.com/">Handlebars.js</a> website and you will see they do this quite regularly.</p>

<p>Perhaps there is a more appropriate way to handle the above example, and I am all ears. But after giving the whole concept of keeping logic completely out of views, I&#39;ve come to the conclusion that it&#39;s really not so ideal. Like Reese&#39;s mixing chocolate and peanut butter, mixing views and logic can be a good thing. The trick is limiting the logic to particular domains, let&#39;s call it &quot;view logic&quot; as opposed to &quot;data logic&quot;.</p>

<p>View logic should be limited to these purposes:</p>

<ul>
<li>Conditions</li>
<li>Sorting</li>
<li>Categorizing</li>
<li>Formatting</li>
</ul>

<p>By limiting view logic to these, I&#39;d say we have still achieved the ideal of &quot;logic-less templates&quot;. By being zealots about the logic-less concept we end-up just creating the opposite problem of mixing our templates into our logic, which is just as bad, if not worse. Template engines, like Handlebars.js, would do well to take this into account and expand their capabilities to include more flexible conditions, sorting, categorizing and formatting constructs and helpers out of the box.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-13-April" title="April 13, 2012">April 13, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/03/21/configuration-rodeo/" rel="prefetch">Configuration Rodeo</a></h2>
            <p><h1>Configuration Rodeo</h1>

<p>The history of configuration file conventions for Ruby projects has not been a particularly conclusive one. No one pervasive convention has ever developed. No developer has ever laid down a clear set of rules of engagement that we all can agree are worthy of follow. Rather, the realm of the developer in working out how to handle configuration for their project tools still smacks a bit of the Wild West. </p>

<p>Nonetheless, although no one approach has superseded all others, there are handful of patterns that tend to be used. We will review these conventions and then consider a possible comprehensive solution that could move us past the chaos du jour. </p>

<h2>The Conventions</h2>

<h3>1. Dot File</h3>

<p>Probably the oldest convention around is the dot-file. A dot-file is, as the name implies, a file with a dot in front of its name. Using traditional Unix shells, files that begin with a dot are <em>hidden files</em>. For the most part all this means is they do not show up in the typical directory listing, although some file tools will also ignore dot-files by default.</p>

<p>Back in the day, these files became the conventional means of adding per-user configuration to a system by adding dot-files to a user&#39;s home directory. There it was easily associated to a user and accessible, yet hidden from normal view. Consequently, project tools have adopted the same idea for project configuration, evidenced most clearly by SCM tools like Subversion (<code>.svn</code>), Git (<code>.git</code>) and Mercurial (<code>.hg</code>). Many Ruby-based tools have followed suite, such as RDoc&#39;s <code>.document</code> and YARD&#39;s <code>.yardopts</code> and <code>.yardoc</code>.</p>

<p>The advantages of the dot-file lies mostly in the fact that it&#39;s a well worn standard, and that it helps somewhat with directory clutter by keeping these files hidden under a typical listing. However, for the same reasons they are also a disadvantage. Many types of file listings do not actually hide these files, for example a GitHub listing, nor is it always advantageous that they be hidden because an important configuration file could go accidentally overlooked. Also dot-files are often without a proper file extension. While file extensions feel archaic, the fact remains that file extensions are still the primary way that file types are identified.</p>

<h3>2. Crapfile</h3>

<p>The so called &quot;Crapfile&quot; convention is another pattern that has been around for a long time in the form of the rather ubiquitous <code>Makefile</code>. Almost all C/C++ projects use the Make tool to handle compiling. In Ruby, this same convention came into vogue by way of the Rake tool, a Ruby emulation of the Make tool. Over the years this convention has become increasing popular. The Bundler project brought us the <code>Gemfile</code>. Heroku introduced the <code>Procfile</code>. And now a proverbial explosion of such files seems to be on the doorsteps of Ruby and Rails projects. </p>

<p>The advantage of the Crapfile is that it is visible and even prominent thanks to it&#39;s initial capitalization. In this sense it is the exact opposite of the dot-file. It&#39;s disadvantage is that too many of them tend to clutter up a project directory. This issue could be partially resolved at least if file listings grouped these files together instead of sorting them in with all-caps files, but as of yet no file listing provides for it. Another disadvantage is again the lack of a file extension. As with dot-files, this leaves many tools such as file editors, unable to handle the file optimally. However some tools do allow for an optional extension, e.g. <code>Rakefile.rb</code> is recognized by Rake, so there is some mitigation of the extension issue.</p>

<h3>3. Task Directory w/ Special Extension</h3>

<p>A third type of common configuration file you will find in Ruby projects is the <code>task/&lt;foo&gt;.&lt;tool&gt;</code> or <code>tasks/&lt;foo&gt;.&lt;tool&gt;</code> file. These files came about as a means of splitting Rakefiles up into topical and shareable units, and indeed this pattern is predominantly used by Rake files, e.g. <code>task/test.rake</code>. But sometimes you will see the pattern used for other tools such as a <code>task/test.watchr</code> file.</p>

<p>The use of <code>task</code> or <code>tasks</code> directory as a conventional location for project configuration files can be advantageous for many project tools. It makes it clear where to find them, the <code>task</code> directory itself is not hidden and does not clutter up a project&#39;s root directory and the design dictates the flexibility of allows multiple, and thus topical, configuration files. However, the issue of the file extension yet again effects these files due to the use the tool name as the extension. Also, there might be a slight downside if a project tool uses the configuration file as a project root marker. This is what Rake does with the Rakefile. While not a show-stopper --after all it can look for <code>task/*.&lt;tool&gt;</code>, it is not quite as ideal for the purpose.</p>

<h3>4. Config Directory</h3>

<p>Rails came along an introduced a variety of conventions for Ruby-based web applications, but also with ramifications for Ruby project&#39;s in general. One of the conventions introduced is the use of a <code>config</code> directory to house configuration files relevant to the Rails project. Unlike files in the <code>task</code> directory, there is no special extension involved. Generally the whole name of the file is used to identify the purpose of the file. For example <code>config/database.yml</code> is used to configure access to the underlying database.</p>

<p>At first glance, using <code>config</code> seems to have all the advantages of the <code>task</code> directory without the any of downsides associated with using special extensions. Nonetheless, the convention hasn&#39;t caught on for non-Rails projects. The reason is unknown to me, but perhaps it as trivial as the the simple fact that the term <code>config</code> is six-characters long, whereas all conventional project directory names, that have managed to persist, are five or less and most often only three or four characters. It might seem a silly thing to get caught up on, but when a developer is looking at project file listings dozens of times a day or more, the fact the one entry should stick out excessively from the rest is what is commonly called an &quot;eye-sore&quot;. And an &quot;eye-sore&quot; is plenty of reason to deter usage. It is interesting to wonder if Rails had chosen a shorter term, say <code>conf/</code> or <code>cfg/</code> if it would have made the jump. In any case, that is mere speculation.</p>

<p>There are a few project&#39;s that support a <code>config</code> directory, and do so to good effect. Cucumber for example will look for either &#39;cucumber.yml&#39;, &#39;config/cucumber.yml&#39; or &#39;.config/cucumber.yml&#39;.</p>

<h3>5. Ordinary File</h3>

<p>The last convention really isn&#39;t a convention at all. Some project tools just designate an ordinary file name as the configuration file and expect to find it in the project&#39;s root directory. In many ways, one could argue this is the best choice. It doesn&#39;t suffer from the file extension issue and the files generally sort separate from documentation files which are capitalized. However, it does suffer a bit in that these files don&#39;t stand out in any way as configuration files. And this fact allows them to still make a project seem cluttered if there are more than just a couple of them.</p>

<h2>When to Use Which</h2>

<p>Hidden dot-files have their place, but they are best reserved for files that the developer will rarely if ever need to edit. Generated files are the best example. The reason for this rule of thumb is simple. If a developer doesn&#39;t see a file, the developer might not realize it already exists or know that he/she may need to edit it. If dot-files do fit your use case, also consider using a dot-directory instead of just a file. This ensures that no additional entries will clutter up the root project directory should more than one configuration file prove necessary or useful.</p>

<p>Crapfiles are not a horrible choice, but as the colorful name suggests, they are not nearly the best choice either. Some developers argue against the use of Crapfiles because the <code>-file</code> suffix is rather redundant. While that&#39;s a fair point, one can also argue that the suffix helps distinguish configuration files from other files. Since Crapfiles tend to standout, they are best suited to configurations that need frequent editing. A word of caution about naming, when you have a tool with a name like &quot;Foreman&quot; and it&#39;s configuration file is called &quot;Procfile&quot;, things are obviously not very intuitive. Consider carefully if perhaps an ordinary file name would suffice instead --it can always be capitalized if it needs to have prominence.</p>

<p>Task files are a good approach for tools that can have multiple configurations or configuration profiles.  But even if a project does not support multiple configurations, there is nothing stopping the <code>task</code> directory form holding ordinary files. Which means it could effectively co-opt the advantages of the <code>config</code> directory too.</p>

<p>As for the <code>config</code> directory. If you are developing a Rails project, obviously that is the place for configuration files. While some have argued that <code>config</code> is just for Rails and should not be co-opted for plain Ruby projects, presumably to save confusion, that seems too strict a view. If using the <code>task</code> directory to the same end doesn&#39;t strike your fancy, then <code>config</code> is clearly the best place to put configuration files. The only good exception is when special prominence is needed that only a root level and unhidden file can bring.</p>

<p>Simple uncaptialized ordinary root level files, while seemingly the least problematic, also have nothing that makes them special, which probably accounts for why they are so rarely used. They might as well be placed in the <code>task</code> or <code>config</code> directory to avoid root directory clutter.</p>

<h2>Is there a Better Way?</h2>

<p>So, is there a better way? That depends on how you look at it. One thing is for certain, there is no <em>perfect</em> way, but that doesn&#39;t exclude the possibility of compelling approach that mitigates most issues.</p>

<p>The overarching problem here is simply the fact that so many conventions exist. With such a variety of naming conventions, it exacerbates the issue of cluttered project directories multiple times over.
Another disadvantage for all of these approaches, they make it difficult to share common configuration.</p>

<p>In an effort to create a comprehensive solution, the <a href="http://github.com/rubyworks/rc">RC</a> project has been created. RC designate a single file, <code>Config.rb</code>, in which all tool configurations can be defined. A typical entry in this file is for test configuration. For example, to configure the <code>qed</code> test tool we might designate:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="n">profile</span> <span class="ss">:coverage</span> <span class="k">do</span>
    <span class="n">config</span> <span class="ss">:qed</span> <span class="k">do</span>
      <span class="nb">require</span> <span class="s1">&#39;simplecov&#39;</span>
      <span class="no">SimpleCov</span><span class="o">.</span><span class="n">start</span> <span class="k">do</span>
        <span class="n">coverage_dir</span> <span class="s1">&#39;log/coverage&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>
<p>RC allows configurations to be grouped into profiles. Tool developers can take advantage of profiles to suite the needs of the tool (or not at all). The major advantage of using a single configuration file is the ability for variant configurations to share settings. Another advantage is to import configurations from other projects. For example, the QED project provides the basic SimpleCov configuration which can be easily reused.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="n">profile</span> <span class="ss">:coverage</span> <span class="k">do</span>
    <span class="n">config</span> <span class="ss">:qed</span><span class="p">,</span> <span class="ss">:from</span><span class="o">=&gt;[</span><span class="ss">:qed</span><span class="p">,</span> <span class="ss">profile</span><span class="p">:</span> <span class="n">simplecov</span><span class="o">]</span>
  <span class="k">end</span>
</code></pre></div>
<p>RC is still a work in progress, but the overarching design is in place with numerous advantages over the scattered approaches of the past. Though some of the traditional approaches might still be more suited to very specific cases, most tools can benefit from a unified approach.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-21-March" title="March 21, 2012">March 21, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/02/25/setting-priorities-trumps-warnings/" rel="prefetch">Setting Priorities Trumps Warnings</a></h2>
            <p><h1>Setting Priorities Trumps Warnings</h1>

<p>Today I had to consider how best to handle omission exceptions in the context of test frameworks, and their use case to mark <em>pending tests</em>. In the course of doing so, I realized there are at least two reasonable levels of omission, those there are &quot;ASAP&quot; and those that are &quot;NSM&quot; (Not So Much). Where as other frameworks used their own specially defined classes for these, e.g <code>Pending</code> and <code>Omission</code>, my approach is to re-utilize Ruby&#39;s own <code>NotImplementedError</code>. But then I had to consider how to differentiate between these priorities.</p>

<p>And that&#39;s when the more general notion occurred to me of <strong>Exception Priorities</strong>.</p>

<p>Consider that instead of raising a warning:</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="nb">warn</span> <span class="s2">&quot;Don&#39;t do it, mate!&quot;</span>
</code></pre></div>
<p>We could use the the Exception system, setting a low &quot;warning&quot; level priority.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="k">raise</span> <span class="s2">&quot;Don&#39;t do it, mate!&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div>
<p>All things being nominal, Ruby would see the priority of this exception is below 0, output the message to <code>$stderr</code> if <code>$VERBOSE=true</code> and then continue on. Hence it is a warning!</p>

<p>With this, <code>#warn</code> could become a simple alias for <code>#raise</code> with a default negative priority.</p>

<p>Now, if that was all there was to it, then there would be little reason to adopt the idea. But there are some really nice advantages to this approach.</p>

<p>With regards to warning messages, we could use the <code>$VERBOSE</code> setting to refine the level of warning we want to be notified about. </p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="vg">$VERBOSE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">raise</span> <span class="s2">&quot;More Serious Warning!&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">raise</span> <span class="s2">&quot;Less Serious Warning!&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
</code></pre></div>
<p>In this case we would never see the <code>-2</code> level warning b/c we&#39;ve indicated we don&#39;t want to see those by setting $VERBOSE to higher specific level.</p>

<p>Interestingly enough, we can do the same for actually raising errors! Let&#39;s call the setting <code>$PRIORITY</code> for the sake of discussion.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="vg">$PRIORITY</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">raise</span> <span class="s2">&quot;More Serious Warning!&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">raise</span> <span class="s2">&quot;Less Serious Warning!&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
</code></pre></div>
<p>Where as before, the &quot;More Serious Warning&quot; would just have printed a warning message to <code>$stderr</code>, in this case the Exception will actually be raised, b/c we have lowered the threshold at which exceptions are to be raised.</p>

<p>This refinement to Ruby&#39;s Exception system, effectively subsuming the warning system within it, makes for a much more powerful, flexible and thus useful system. Take my original use case, I can set the priority of NotImplementedError to <code>1</code> for ASAPs and <code>0</code> for NSMs, and I can go further allowing testers to set high priorities to be selectable from the command line.</p>

<p>Want another use case? How about a <code>DeprecatedError</code> that has a default priority of <code>-1</code>.</p>

<p>I am certain other will think of other use cases as well. This is one of those pliable features that tend to have far wider applicability then the originating use case.</p>

<p>P.S. I&#39;ve always thought is would make more sense if <code>$VERBOSE</code> were called <code>$WARN</code>.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-25-February" title="February 25, 2012">February 25, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2012/01/19/rubys-unexceptional-exception-constructor/" rel="prefetch">Rubys Unexceptional Exception Constructor</a></h2>
            <p><p>You would think after all this time Ruby&#39;s Exception class would be a rather robust and clearly comprehensible class.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">  <span class="k">raise</span><span class="p">(</span><span class="n">exception</span> <span class="o">[</span><span class="p">,</span> <span class="n">string</span> <span class="o">[</span><span class="p">,</span> <span class="n">array</span><span class="o">]]</span><span class="p">)</span>
</code></pre></div>
<p>Now lets try something </p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">MyError</span> <span class="o">&lt;</span> <span class="no">Exception</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">()</span>
    <span class="k">super</span><span class="p">()</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="o">&gt;&gt;</span> <span class="k">raise</span> <span class="no">MyError</span>
<span class="ss">MyError</span><span class="p">:</span> <span class="no">MyError</span>
    <span class="n">from</span> <span class="p">(</span><span class="n">irb</span><span class="p">):</span><span class="mi">12</span>
    <span class="n">from</span> <span class="sr">/home/</span><span class="n">trans</span><span class="o">/.</span><span class="n">rbenv</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">rc1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="ss">irb</span><span class="p">:</span><span class="mi">12</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;&#39;</span>
</code></pre></div>
<p>No problem. But now lets try to set the message and the backtrace.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="o">&gt;&gt;</span> <span class="k">raise</span> <span class="no">MyError</span><span class="p">,</span> <span class="s2">&quot;This is an error!&quot;</span>
<span class="ss">ArgumentError</span><span class="p">:</span> <span class="n">wrong</span> <span class="n">number</span> <span class="n">of</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">from</span> <span class="p">(</span><span class="n">irb</span><span class="p">):</span><span class="mi">8</span><span class="ss">:in</span> <span class="sb">`initialize&#39;</span>
<span class="sb">    from (irb):13:in `</span><span class="n">exception</span><span class="s1">&#39;</span>
<span class="s1">    from (irb):13:in `raise&#39;</span>
</code></pre></div>
<p>Clearly Ruby expects any Exception&#39;s initialize method to handle the message argument. That&#39;s a rather strict contract for something Ruby is letting us override. But okay, let&#39;s take that as a given. Obviously Ruby is routing the #raise call to the exception&#39;s initializer. So then we should that the third <code>array</code> argument would passed along too. Turns out that&#39;s not the case.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">MyError</span> <span class="o">&lt;</span> <span class="no">Exception</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="nb">p</span> <span class="n">args</span>
    <span class="k">super</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="o">&gt;&gt;</span> <span class="k">raise</span> <span class="no">MyError</span><span class="p">,</span> <span class="s2">&quot;This is an error!&quot;</span><span class="p">,</span> <span class="nb">caller</span>
<span class="o">[</span><span class="s2">&quot;This is an error!&quot;</span><span class="o">]</span>
<span class="ss">RuntimeError</span><span class="p">:</span> <span class="no">This</span> <span class="n">is</span> <span class="n">an</span> <span class="no">Error</span><span class="o">!</span>
    <span class="n">from</span> <span class="p">(</span><span class="n">irb</span><span class="p">):</span><span class="mi">1</span>
    <span class="n">from</span> <span class="sr">/home/</span><span class="n">trans</span><span class="o">/.</span><span class="n">rbenv</span><span class="o">/</span><span class="n">versions</span><span class="o">/</span><span class="mi">1</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">3</span><span class="o">-</span><span class="n">rc1</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="ss">irb</span><span class="p">:</span><span class="mi">12</span><span class="ss">:in</span> <span class="sb">`&lt;main&gt;&#39;</span>
</code></pre></div>
<p>Nope. No caller in sight. So where did it go? Turns out Ruby is setting the caller via the error&#39;s <code>#set_backtrace</code> method and doesn&#39;t depend on the initializer to handle it at all. This seems rather odd, since it was keen on letting the initializer handle the message argument, and would blow-up if the class won&#39;t take it.</p>

<p>So the upshot seems to be that we can&#39;t customize an exceptions initializer adn expect <code>#raise</code> to play along.</p>

<p>I actually had another point to make about how things gets even worse. Unfortunately had to take care of other chores and by the time I got back to this blog post (months later) I forgot what these &quot;worse things&quot; were. I think it had something to do with how <code>#message</code> calls <code>#to_s</code> rather then returning the message passed to the initializer. But as said I am not certain now. </p>

<p>My conclusion however is this. I was attempting to make use of an Exception class as something more than a mere container for a string message for the <a href="http://github.com/rubyworks/assay">Assay</a> project. That is when I ran into these oddities which made doing so quite unpleasant. To my dismay I ended up abandoning the approach. I brought some aspects of this up in a <a href="http://bugs.ruby-lang.org/issues/5898">issue report</a>.</p>

<p>For reference, here is the relevant Ruby <a href="https://github.com/ruby/ruby/blob/trunk/eval.c">source code</a>.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2012-19-January" title="January 19, 2012">January 19, 2012</time>
            </div>
        </div>
        <hr>
    </section>
    
    
  
    <section class="index">
        <!-- -->
        <div>
            <h2 class="title"><a href="/2011/10/04/lazy-plus-enumerable-begats-denumerable/" rel="prefetch">Lazy Plus Enumerable Begats Denumerable</a></h2>
            <p><h1>Lazy + Enumerable = Denumerable</h1>

<p>All Rubyists know and love Enumerable. It&#39;s the really the showcase of Ruby&#39;s mixin system. Some Rubyists also know and appreciate <a href="http://moonbase.rydia.net/software/lazy.rb/">lazy.rb</a> MenTaLguY&#39;s excellent lazy evaluation library. But did you know there is library that essentially cross-breeds the ideas of both? It&#39;s called <a href="http://github.com/rubyworks/facets/blob/master/lib/core/facets/denumerable.rb">Denumerable</a> and is included in Ruby Facets (<code>require &#39;facets/denumerable&#39;</code>).</p>

<p>According to Webster&#39;s The term <code>denumerable</code> is just a synonym for <code>enumerable</code>. In Ruby parlance, it takes a more useful distinction of &quot;deferred enumerable&quot;. In other words Denumerable defers actual calculations of a chain of enumerable method calls until the results are actually needed. That&#39;s where the &quot;laziness&quot; comes in. By deferring calculation Ruby is able to optimize the algorithm, in many cases greatly improving performance. It&#39;s even possible to enumerate infinite ranges if the end result itself is finite.</p>

<p>To make it even more convenient there is <a href="http://github.com/rubyworks/facets/blob/master/lib/core/facets/enumerable/defer.rb">Enumerable#defer</a> (<code>require &#39;facets/enumerable/defer&#39;</code>) which delegates an Enumerable object through a Denumerator, just like Ruby&#39;s core Enumerator class.</p>

<p>So, enough talk, right? How about an example.</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby">    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">1_000_000_000</span><span class="p">)</span><span class="o">.</span><span class="n">defer</span><span class="o">.</span><span class="n">select</span><span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span><span class="o">.</span>
                                 <span class="n">map</span><span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">100</span> <span class="p">}</span><span class="o">.</span>
                                 <span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
    <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">102</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">120</span><span class="o">]</span>
</code></pre></div>
<p>The performance gains of Denumerable cannot be understated. The above example takes 1/10000th of a second to run on my system. I wanted to provide the time it takes to run without <code>defer</code>, but after an hour of waiting and listening to it eat my hard drive for breakfast, I gave up.</p>
</p>
            <div class="meta">
                Written By <address></a> &mdash;
                <time pubdate datetime="2011-04-October" title="October 04, 2011">October 04, 2011</time>
            </div>
        </div>
        <hr>
    </section>
    
    
    <section class="pagination" style="text-align:center">
      
        
        <a href="/page2" class="btn btn-outline">‹ Newer</a>
        
      
      
        <a href="/page4" class="btn btn-outline">Older ›</a>
      
    </section>
</article>


<footer class="site-footer">
    <div class="container">
        &copy; 2014 
        
        <nav>
            <a href="http://tabcomputing.com/">Tab Computing</a> &middot;
            <a href="/">Blog</a> &middot;
            <a href="http://incorporated.sendtoinc.com/">Product</a> &middot; 
            <a href="https://tabcomputing.com/about/">About</a>
        </nav>
        
        <nav class="social">
            
                
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
        <p>Incorporated theme by <a href="https://sendtoinc.com">Inc</a></p>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>






</body>
</html>
